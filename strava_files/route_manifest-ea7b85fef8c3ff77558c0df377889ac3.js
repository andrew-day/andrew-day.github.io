(function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Athlete=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(Backbone.Model)}).call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,i,r;i=[];for(e in t)r=t[e],i.push(this.initAttribute(e,r));return i},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var i;return this.constructor.prototype[t]=function(t){return this.setOrGet(i,t)},i="_"+t,this[i]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,i){var r,n,a;null==i&&(i=!1),i&&this.setLocalStorage(e,{}),n=[];for(r in t)a=t[r],n.push(this.initStorageAttribute(r,a,e));return n},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,i){var r;return r=this.getLocalStorage(i),void 0!==e?(r[t]=e,this.setLocalStorage(i,r),this):r[t]},initStorageAttribute:function(t,e,i){var r,n;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(r,t,i)},r="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return n=this.setOrGetStorage(r,void 0,i),void 0!==n&&(e=n),this.setOrGetStorage(r,e,i);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,i){var r,n,a,s;return s=this,r=e,n=t,a=function(){return r.call(this),s.unbind(n,a)},this.bind(t,a,i)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function i(){i.__super__.constructor.call(this)}return t(i,e),Strava.includeModule(i,Strava.base_module),i.prototype.parse=function(){return{id:0}},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.PageContext=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.routes(new Strava.Routes.Routes(t))}var r;return t(i,e),r={routeAthlete:null,routes:null,mapIdBase:null,fullscreen:!1,startMenu:"overview",view:"overview",minSegmentFilterRatio:.2,route:null,routeLegs:null,routeSegments:null,pagination:null,filters:null,hasRoutes:!1,speed:null},i.prototype.enterFullScreen=function(){return this.fullscreen(!0),this.trigger("fullscreenchange",!0)},i.prototype.exitFullScreen=function(){return this.fullscreen(!1),this.trigger("fullscreenchange",!1)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.PageView=function(e){function i(t,e,n){var a;null==n&&(n=!0),i.__super__.constructor.call(this),this.initializeAttributes(r),this.factory(e),this.routeId(t),this.pageContext(new Strava.Routes.PageContext),this.loggedIn(n),this.loggedIn()||(a=new Strava.Routes.RouteUpsellView,this.$$(".container").on("click",".routes-upsell",function(t){return a.render(jQuery(t.currentTarget).data())}))}var r;return t(i,e),r={baseUrl:"routes",eventDispatcher:null,factory:null,pageContext:null,mapContext:null,chartContext:null,menuRouter:null,routeId:null,routeData:null,route:null,routeSegments:null,routeAthlete:null,routeDataContext:null,loggedIn:!1,speed:null},i.prototype.assemble=function(t){var e,i;return e=new Strava.Routes.EventDispatcher,this.eventDispatcher(e),this.routeDataContext(new Strava.Routes.RouteDataContext(this.routeData().route.legs)),this.mapContext(new Strava.Maps.RouteMapContext(this.routeDataContext(),e)),this.chartContext(new Strava.Routes.RouteChartContext(this.routeDataContext(),e)),this.route(new Strava.Routes.Route(_.extend({route_id:this.routeId()},this.routeData().metadata))),this.pageContext().routeAthlete(this.routeAthlete()).route(this.route()).routeLegs(this.routeData().route.legs).routeSegments(this.routeSegments()).speed(this.speed()),i=new Strava.Routes.MenuRouter(this.baseUrl(),t,this.routeId(),this.pageContext()).addMenuItem("export","export"),this.factory().page(this),this.menuRouter(i),i.bind("route:export",function(t){return function(){return t.exportRoute()}}(this)),this},i.prototype.ready=function(){return this.factory().createOverviewView(),this.prepareExportLightbox(),this.menuRouter().start(),this},i.prototype.prepareExportLightbox=function(){return jQuery(".export-route").click(function(t){return function(e){return e.preventDefault(),t.exportRoute()}}(this))},i.prototype.exportRoute=function(){return Strava.Routes.ExportLightboxView.show({model:new Backbone.Model})},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["routes/cue_sheet"]=function(t){return function(){var t,e,i,r,n,a,s,o,l,u,h,c,p,d;for(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],a=new Strava.I18n.DistanceFormatter(Strava.I18n.Locale.unitSystem()),s=new Strava.I18n.ElevationFormatter(Strava.I18n.Locale.unitSystem()),o=0;this.directions[o];){for(i.push("<div class='row'>"),p=[o,o+1],l=0,h=p.length;h>l;l++){if(r=p[l],i.push("  <div class='spans8'>"),0===r&&(i.push("    <div class='metadata'>\n      <img class='branding' src='/assets/application/print/strava-logo.jpg' alt='"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.strava_logo")))+"'>\n      <h2 class='marginless'>"+e(t(this.route.name))+"</h2>"),i.push("      "+e(t(this.url))),i.push("      <ul class='inline-stats'>\n        <li>\n          <strong>"),i.push("            "+e(t(this.route.lengthDisplay))),i.push("            \x91<abbr class='unit' title='"+e(t(a.unitLong()))+"'>"+e(t(a.unitShort()))+"</abbr>\x92\n          </strong>\n          <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.distance")))+"</div>\n        </li>\n        <li>\n          <strong>"),i.push("            "+e(t(this.route.elevationGainDisplay))),i.push("            \x91<abbr class='unit' title='"+e(t(s.unitLong()))+"'>"+e(t(s.unitShort()))+"</abbr>\x92\n          </strong>\n          <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.elevation_gain")))+"</div>\n        </li>\n        <li>\n          <strong class='sub-type'>"+e(t(this.route.displaySubType))+"</strong>\n          <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet."+this.route.typeKey+"_type")))+"</div>\n        </li>\n      </ul>"),this.movingTime&&(i.push("      <div class='moving-time'>\n        <span class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.estimated_moving_time")+":"))+"</span>"),i.push("        "+e(t(this.movingTime))),i.push("      </div>")),i.push("    </div>\n    <div id='map-canvas'>\n      <div class='centered spinner'>\n        <div class='graphic'></div>\n      </div>\n    </div>\n    <div id='chart-container'>\n      <div class='base-chart'></div>\n    </div>\n    <div id='disclaimer-text'>"),i.push("      "+e(t(this.disclaimerText))),this.movingTime&&(i.push("      <span class='moving-time-explanation'>"),i.push("        "+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.estimated_moving_time")+" "+this.movingTimeExplanation))),i.push("      </span>")),i.push("    </div>")),this.directions[r]){for(i.push("    <table class='dense'>\n      <thead>\n        <tr>\n          <th scope='col'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.direction_uc")))+"</th>\n          <th scope='col'>"+e(t(Strava.I18n.Locale.t("templates.routes.cue_sheet.distance_uc")+" ("+a.unitLong()+")"))+"</th>\n        </tr>\n      </thead>\n    </table>\n    <table class='dense'>\n      <tbody>"),d=this.directions[r],u=0,c=d.length;c>u;u++)n=d[u],i.push("        <tr>\n          <td>"),i.push("            "+e(t(n.detail))),i.push("          </td>\n          <td>"),i.push("            "+e(t(n.distance))),i.push("          </td>\n        </tr>");i.push("      </tbody>\n    </table>")}i.push("  </div>")}i.push("</div>"),o+=2}return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.CueSheetView=function(e){function i(t,e,r,n){var a,s;i.__super__.constructor.call(this),this.template="routes/cue_sheet",this.url=t,this.routeData=e,this.disclaimerText=r,this.speed=n,s=new Strava.Routes.EventDispatcher,a=new Strava.Routes.RouteDataContext(this.routeData.route.legs),this.mapContext=new Strava.Maps.RouteMapContext(a,s),this.chartContext=new Strava.Routes.RouteChartContext(a,s)}return t(i,e),i.prototype.tagName="div",i.FIRST_COLUMN_LENGTH=18,i.SUBSEQUENT_COLUMN_LENGTH=37,i.prototype.render=function(){var t,e,r,n,a,s,o,l,u,h,c,p,d,f,v,g,y,x,m;for(n=[],m=0,v=this.routeData.route.legs,a=0,u=v.length;u>a;a++)for(l=v[a],g=l.paths,s=0,h=g.length;h>s;s++)if(f=g[s],null!=f.directions){for(y=f.directions,o=0,c=y.length;c>o;o++)e=y[o],r=e.distance+m,n.push({distance:Strava.Routes.Route.distanceDisplay(r),detail:Strava.Routes.Route.directionString(Strava.Routes.Route.directionAction(e.action),e.name)});m+=f.length}for(n.push({distance:Strava.Routes.Route.distanceDisplay(m),detail:Strava.I18n.Locale.t("templates.routes.route.directions.arrive")}),this.speed&&this.speed>0&&(p=Strava.Routes.Route.movingTime(this.routeData.metadata.length,this.speed),d=Strava.Routes.Route.movingTimeExplanation(this.speed,this.routeData.metadata.route_type,!0)),t={url:this.url,route:new Strava.Routes.Route(this.routeData.metadata).present(),directions:[],disclaimerText:this.disclaimerText,movingTime:p,movingTimeExplanation:d},t.directions.push(n.slice(0,i.FIRST_COLUMN_LENGTH)),x=n.slice(i.FIRST_COLUMN_LENGTH,n.length);x.length;)t.directions.push(x.slice(0,i.SUBSEQUENT_COLUMN_LENGTH)),x=x.slice(i.SUBSEQUENT_COLUMN_LENGTH,x.length);return this.renderTemplate(t),this},i.prototype.ready=function(){var t;return t=new Strava.Maps.Google.Construction.MapFactory(this.mapContext,this.$$("#map-canvas")).builderClass(Strava.Maps.Google.Construction.RouteMapBuilder).interactiveMap(!1),this.mapContext.ready(),new Strava.Routes.ElevationChartView(this.chartContext,75),this.chartContext.ready()},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Labs.Activities"),Strava.Labs.Activities.EventDispatcher=function(e){function i(){i.__super__.constructor.call(this),this.mouseIndexes={},this.hoverExtent=null,this.selection=null}return t(i,e),i.prototype.addListener=function(t,e){return this.bind("mouseOver",function(i,r,n){return t!==i?e.handleStreamMouseOver(r,n):void 0}),this.bind("slide",function(i,r,n){return t!==i&&null!=e.handleStreamSlide?e.handleStreamSlide(r,n):void 0}),this.bind("slideReset",function(i,r,n){return t!==i&&null!=e.handleStreamSlideReset?e.handleStreamSlideReset(r,n):void 0}),this.bind("mouseOut",function(i,r){return t!==i&&null!=e.handleStreamMouseOut?e.handleStreamMouseOut(r):void 0}),this.bind("click",function(i,r,n){return t!==i?e.handleStreamClick(r,n):void 0}),this.bind("doubleClick",function(i,r,n){return t!==i?e.handleStreamDoubleClick(r,n):void 0}),this.bind("hover",function(i,r,n,a){return t!==i&&null!=e.handleStreamHover?e.handleStreamHover(r,n,a):void 0}),this.bind("hoverOut",function(i,r,n,a){return t!==i&&null!=e.handleStreamHoverOut?e.handleStreamHoverOut(r,n,a):void 0}),this.bind("select",function(i,r,n,a){return t!==i?e.handleStreamSelect(r,n,a):void 0}),this.bind("unselect",function(i,r,n,a){return t!==i?e.handleStreamUnselect(r,n,a):void 0}),this.bind("zoomSelect",function(i,r,n,a,s){return t!==i&&null!=e.handleZoomSelect?e.handleZoomSelect(r,n,a,s):void 0}),this.bind("zoomUnselect",function(i,r,n,a){return t!==i&&null!=e.handleZoomUnselect?e.handleZoomUnselect(r,n,a):void 0}),this.bind("indexedZoom",function(i,r,n,a){return t!==i&&null!=e.handleIndexedZoom?e.handleIndexedZoom(r,n,a):void 0}),this.bind("initiateZoom",function(i,r,n,a){return t!==i&&null!=e.handleInitiateZoom?e.handleInitiateZoom(r,n,a):void 0}),this.bind("zoomChange",function(i,r){return t!==i&&null!=e.handleZoomChange?e.handleZoomChange(i,r):void 0}),this.bind("changeXAxisType",function(i,r){return t!==i&&null!=e.handleChangeXAxisType?e.handleChangeXAxisType(r):void 0}),this.bind("markerClick",function(i,r,n,a){return t!==i&&null!=e.handleMarkerClick?e.handleMarkerClick(r,n,a):void 0})},i.prototype.dispatchMouseOver=function(t,e,i){return this.mouseIndexes[e]!==i?(this.mouseIndexes[e]=i,this.trigger("mouseOver",t,e,i)):void 0},i.prototype.dispatchSlide=function(t,e,i){return this.trigger("slide",t,e,i)},i.prototype.dispatchSlideReset=function(t,e,i){return this.trigger("slideReset",t,e,i)},i.prototype.dispatchClick=function(t,e,i){return this.trigger("click",t,e,i)},i.prototype.dispatchDoubleClick=function(t,e,i){return this.trigger("doubleClick",t,e,i)},i.prototype.dispatchHover=function(t,e,i,r){return this.hoverExtent=[i,r],null==this.selection?this.trigger("hover",t,e,i,r):void 0},i.prototype.dispatchUnconditionalHover=function(t,e,i,r){return this.hoverExtent=[i,r],this.trigger("hover",t,e,i,r)},i.prototype.dispatchHoverOut=function(t,e,i,r){return this.hoverExtent=null,null==this.selection?this.trigger("hoverOut",t,e,i,r):void 0},i.prototype.dispatchSelect=function(t,e,i,r){return this.selection=[i,r],this.trigger("select",t,e,i,r)},i.prototype.dispatchUnselect=function(t,e,i,r){var n,a,s;return this.selection=null,this.trigger("unselect",t,e,i,r),this.hoverExtent?(s=this.hoverExtent,a=s[0],n=s[1],this.trigger("hover",t,e,a,n)):void 0},i.prototype.dispatchZoomSelect=function(t,e,i,r,n){return this.trigger("zoomSelect",t,e,i,r,n)},i.prototype.dispatchZoomUnselect=function(t,e,i,r){return this.trigger("zoomUnselect",t,e,i,r)},i.prototype.dispatchMouseOut=function(t,e){return-1===this.mouseIndexes[e],this.trigger("mouseOut",t,e)},i.prototype.dispatchIndexedZoom=function(t,e,i,r){return this.trigger("indexedZoom",t,e,i,r)},i.prototype.dispatchInitiateZoom=function(t,e,i,r){return this.trigger("initiateZoom",t,e,i,r)},i.prototype.dispatchZoomChange=function(t,e){return this.trigger("zoomChange",t,e)},i.prototype.dispatchChangeXAxisType=function(t,e){return this.trigger("changeXAxisType",t,e)},i.prototype.dispatchMarkerClick=function(t,e,i,r){return this.trigger("markerClick",t,e,i,r)},i.prototype.reset=function(){return this.off(),this.selection=null,this.hoverExtent=null},i}(Strava.Base),Strava.Labs.Activities.listener_module={handleStreamMouseOver:function(){},handleStreamSlide:function(){},handleStreamSlideReset:function(){},handleStreamMouseOut:function(){},handleStreamClick:function(){},handleStreamDoubleClick:function(){},handleStreamSelect:function(){},handleStreamUnselect:function(){},handleStreamHover:function(){},handleStreamHoverOut:function(){},handleChangeXAxisType:function(){},handleMarkerClick:function(){}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.EventDispatcher=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.addListener=function(t,e){return i.__super__.addListener.call(this,t,e),this.bind("estimateMouseOver",function(i,r,n){return t!==i&&null!=e.handleEstimateStreamMouseOver?e.handleEstimateStreamMouseOver(r,n):void 0})},i.prototype.dispatchEstimateMouseOver=function(t,e,i){return this.trigger("estimateMouseOver",t,e,i)},i}(Strava.Labs.Activities.EventDispatcher)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Grid=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t)}var r;return t(i,e),r={builder:null,xOffset:0},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),e=t.axis().xAxis.ticks(),r=t.axis().xScale.ticks(e[0]),i=t.mainGroup.append("svg:g").attr("id","grid"),i.append("rect").attr({x:0,y:0,height:t.height(),width:t.width()-this.xOffset(),"class":"event-rect"}).style("fill","transparent").on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)}}(this))).on("click",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("gridclick",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(e){return t.insideChart(d3.event.relatedTarget)?void 0:t.trigger("gridout",e)}}(this))),i.selectAll("line.vgrid-line").data(r).enter().insert("line",":first-child").attr({x1:t.axis().xScale,x2:t.axis().xScale,y1:0,y2:t.height(),"class":"grid-line vgrid-line"}),e=t.axis().yAxis.ticks(),r=t.axis().yScale.ticks(e[0]),i.selectAll("line.hgrid-line").data(r).enter().insert("line",":first-child").attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale,"class":"grid-line hgrid-line"})},i.prototype.update=function(){var t,e,i,r,n,a;return t=this.builder(),i=t.mainGroup.select("#grid"),e=t.axis().xAxis.ticks(),r=t.axis().xScale.ticks(e[0]),n=i.selectAll("line.vgrid-line").data(r),n.enter().insert("line",":first-child").attr({x1:t.axis().xScale,x2:t.axis().xScale,y1:0,y2:t.height(),"class":"grid-line vgrid-line"}),n.transition().attr({x1:t.axis().xScale,x2:t.axis().xScale}),n.exit().remove(),e=t.axis().yAxis.ticks(),r=t.axis().yScale.ticks(e[0]),a=i.selectAll("line.hgrid-line").data(r),a.enter().insert("line",":first-child").attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale,"class":"grid-line hgrid-line"}),a.transition().attr({x1:0,x2:t.width(),y1:t.axis().yScale,y2:t.axis().yScale}),a.exit().remove()},i.prototype.updateCanvas=function(){return this.builder().mainGroup.select(".event-rect").attr({width:this.builder().width()-this.xOffset()}),this.update()},i.prototype.checkGridOut=function(t){return this.insideChart(d3.event.relatedTarget)?void 0:this.trigger("gridout",t)},i.prototype.insideChart=function(t){return jQuery(t).closest(".chartGroup").length>0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Base=function(e){function i(){i.__super__.constructor.call(this),this.originalDomainX=null,this.originalDomainY=null}return t(i,e),Strava.includeModule(i,Strava.chart_module),i.prototype.create=function(){return this.originalDomainX=this.xScale().domain(),this.originalDomainY=this.yScale().domain()},i.prototype.zoom=function(t,e,i){return null==e&&(e=null),null==i&&(i=!0),i=this.shouldAnimate(i),this.xScale().domain(t),e&&this.yScale().domain(e),this.update(i)},i.prototype.resetZoom=function(t){return null==t&&(t=!0),this.zoom(this.originalDomainX,this.originalDomainY,t)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Line=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.filter=(new Strava.D3.Charts.DataFilter).graph(this)}var r;return t(i,e),r={builder:null,data:[],fill:!0,style:"simple-line",strokeWidth:"1.5px",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),id:"generic-line",interpolator:"",duration:1e3,stroke:null,clipPathId:"",animate:null},i.prototype.create=function(){var t,e,r,n;return i.__super__.create.call(this),t=this.builder(),this.animate(t.animate()),n=t.root,n.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:0,height:t.height(),width:t.width()}),this.line=d3.svg.line().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.line.interpolate(this.interpolator()),e=t.mainGroup.insert("svg:g","g#crossBar").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")"}),r=this.filter.filter(),e.selectAll("path").data([r]).enter().append("path").attr({fill:"none","stroke-width":this.strokeWidth(),"class":this.style(),d:this.line})},i.prototype.update=function(t){var e,i,r,n,a;return null==t&&(t=!0),t=this.shouldAnimate(t),e=this.builder(),i=e.mainGroup.select("#"+this.id()),r=this.filter.filter(),n=i.selectAll("path").data([r]),n.enter().append("path").attr({fill:"none","stroke-width":this.strokeWidth(),"class":this.style(),d:this.line}),a=t?n.transition().duration(this.duration()).delay(0):n,a.attr({d:this.line}),n.exit().remove()},i.prototype.updateWithoutDelay=function(){var t,e,i,r;return t=this.builder(),i=this.filter.filter(),e=t.mainGroup.select("#"+this.id()),r=e.selectAll("path").data([i]),r.attr("d",this.line)},i.prototype.show=function(){return this.builder().mainGroup.select("#"+this.id()).attr("display","")},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.id()).attr("display","none")},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarChart=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.clipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,data:null,fill:!0,style:"simple-bar default",xScale:null,yScale:null,id:"generic-bar",interpolator:"",duration:1e3,clipPathId:"",width:960,yOffset:0,xOffset:0},i.prototype.create=function(){var t,e;return e=this.builder().root,e.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:this.width()}),t=this.builder().mainGroup.append("svg:g").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")"),t.selectAll("rect").data(this.data()).enter().append("rect").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return t.yScale()(e.y)}}(this),width:function(t){return function(e){return t.xScale()(e.width)}}(this),height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this),"class":function(t){return function(e){return t.style()+" "+e.tag}}(this),id:function(t){return"split-"+t.index}}).on("mouseover",this.createHandler(function(t){return function(e){var i,r;return i=d3.select(e),r=i.attr("id").slice(6),t.trigger("barEnter",r,null!=t.selectedId)}}(this))).on("click",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.select(e),n=i.classed("selected"),r=i.attr("id").slice(6),n?t.unSelectSplits():(t.unSelectSplits(),t.selectSplit(r)),t.trigger("barClick",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(e){var i,r;return i=d3.select(e),r=i.attr("id").slice(6),t.unHighlightSplits(),t.trigger("barOut",e,r,null!=t.selectedId)}}(this))).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)}}(this)))},i.prototype.update=function(t){var e,i;return null==t&&(t=!1),e=this.builder().mainGroup.select("#"+this.id()),i=e.selectAll("rect").data(this.data()),t&&(i=i.transition().delay(0)),i.attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),width:function(t){return function(e){return Math.abs(t.xScale()(e.width)-t.xScale()(0))}}(this),height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this)})},i.prototype.show=function(){var t;return t=this.builder().mainGroup.select("#"+this.id()),t.attr("display",""),t.selectAll("rect").transition().duration(300).delay(0).attr({height:function(t){return function(e){return null!=e.height?e.height:t.builder().height()-t.yScale()(e.y)}}(this),y:function(t){return function(e){return t.yScale()(e.y)}}(this)})},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect").attr({height:0,y:this.builder().height()}),this.builder().mainGroup.select("#"+this.id()).attr("display","none")},i.prototype.getSelectedSplitId=function(){return this.selectedId},i.prototype.selectSplit=function(t){return this.selectedId=null,this.highlightSplit(t),this.builder().mainGroup.select("#"+this.id()).selectAll("rect#split-"+t).classed("selected",!0),this.selectedId=t},i.prototype.unSelectSplits=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect.simple-bar").classed("selected",!1),this.selectedId=null},i.prototype.highlightSplit=function(t){return this.selectedId?void 0:this.builder().mainGroup.select("#"+this.id()).selectAll("rect#split-"+t).classed("highlighted",!0)},i.prototype.unHighlightSplits=function(){return this.builder().mainGroup.select("#"+this.id()).selectAll("rect.simple-bar").classed("highlighted",!1)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarChartKey=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={builder:null,data:null,fill:!0,style:"simple-bar",xDomain:null,xScale:null,yScale:null,id:"generic-bar",interpolator:"",duration:1e3,xTranslation:0,keyWidth:15,keyToElbow:5,elbowToEnd:5,endToText:5,circleRadius:3,textBoxHeight:30,xOffset:0,yOffset:0},i.prototype.create=function(){var t,e;return t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.id()).attr("transform","translate("+this.xTranslation()+", "+this.yOffset()+")"),this.data().key&&(e.selectAll("rect").data(this.data().key).enter().append("rect").attr("width",this.keyWidth()).attr("x",0).attr("y",function(t){return function(e){return t.yScale()(e.upperBound)}}(this)).attr("height",function(t){return function(e){return t.yScale()(e.upperBound)-t.yScale()(e.lowerBound)}}(this)).attr("class",function(t){return function(e){return t.style()+" "+e.tag}}(this)),e.selectAll(".key-text").data(this.data().keyText).enter().append("text").classed("chart-label",!0).attr("x",this.keyWidth()/2).attr("y",function(){return function(t){return t.y}}(this)).text(function(){return function(t){return t.text}}(this)).attr("text-anchor","middle")),this.addLines(this.data().lineData)},i.prototype.update=function(){},i.prototype.addLines=function(t){var e,i;return e=this.builder().mainGroup.append("svg:g").attr("id","avg-line").attr("transform","translate(0, "+this.yOffset()+")"),this.addLine(e,t.middle),i=this.builder().mainGroup.append("svg:g").attr("id","fast-slow-lines").attr("transform","translate(0, "+this.yOffset()+")"),this.addLine(i,t.top,this.findOffset("top",t.middle.raw,t.top.raw)),this.addLine(i,t.bottom,this.findOffset("bottom",t.middle.raw,t.bottom.raw))},i.prototype.findOffset=function(t,e,i){var r,n;return r=this.yScale()(e),n=this.yScale()(i),"top"===t?n>=r?-1*(this.textBoxHeight()+(n-r)):n>=r-this.textBoxHeight()?-1*(this.textBoxHeight()-(r-n)):0:r>=n?this.textBoxHeight()+(r-n):n<=r+this.textBoxHeight()?this.textBoxHeight()-(n-r):0},i.prototype.addLine=function(t,e,i){var r,n,a,s,o,l;return a={x:this.xScale()(e.split),y:this.yScale()(e.raw)},s={x:this.xTranslation()+this.keyWidth()+this.keyToElbow()+this.elbowToEnd()},null!=i&&0!==i?(s.y=this.yScale()(e.raw)+i+1,r={x:s.x-this.elbowToEnd(),y:a.y},n={x:s.x-this.elbowToEnd(),y:s.y},t.append("line").attr("class",e.className).attr("x1",a.x).attr("y1",a.y).attr("x2",r.x).attr("y2",r.y),t.append("line").attr("class",e.className).attr("x1",r.x).attr("y1",r.y).attr("x2",n.x).attr("y2",n.y),t.append("line").attr("class",e.className).attr("x1",n.x).attr("y1",n.y).attr("x2",s.x).attr("y2",s.y)):(s.y=this.yScale()(e.raw),t.append("line").attr("class",e.className).attr("x1",a.x).attr("y1",a.y).attr("x2",s.x).attr("y2",s.y)),-1===e.className.indexOf("avg")&&t.append("circle").attr("class",e.className).attr("cx",a.x).attr("cy",a.y).attr("r",this.circleRadius()),o={x:s.x+this.endToText(),y:s.y-8},l={x:s.x+this.endToText(),y:s.y+5},t.append("text").classed("chart-label",!0).attr("x",o.x).attr("y",o.y).attr("dy",".35em").text(e.text1).attr("text-anchor","left"),t.append("text").classed("chart-value",!0).attr("x",l.x).attr("y",l.y).attr("dy",".35em").text(e.text2).attr("text-anchor","left"),t.append("line").attr("class",e.className.replace(/-avg/,"")).attr("x1",o.x-this.endToText()).attr("y1",o.y+5).attr("x2",l.x-this.endToText()).attr("y2",l.y-2)},i.prototype.showFastSlowLines=function(){return this.builder().mainGroup.select("#fast-slow-lines").attr("display","")},i.prototype.hideFastSlowLines=function(){return this.builder().mainGroup.select("#fast-slow-lines").attr("display","none")},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.DataFilter=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={graph:null,streamData:null},i.prototype.filter=function(){var t,e,i,r,n,a,s,o,l,u,h;if(null==this.graph())return[];if(null==this.graph().data()||!this.graph().data().length)return[];for(e=this.graph().data(),h=this.graph().xScale()(e[0].x),t=this.graph().xScale()(e[e.length-1].x),a=t-h,s=Math.max(1,Math.round(this.graph().data().length/a)),n=function(t){return function(e){var i,r,n;return r=t.graph().xScale().domain(),i=(r[1]-r[0])/2,r[0]-i<=(n=e.x)&&n<=r[1]+i}}(this),u=[],r=i=0,o=e.length,l=s;l>0?o>i:i>o;r=i+=l)n(e[r])&&u.push(e[r]);return u},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Util={autoDomain:function(t,e){var i,r,n,a,s,o,l,u,h,c;return null==e&&(e={}),_.defaults(e,{paddingBottom:0,paddingTop:0,innerClamp:0}),r=d3.extent(t),a=r[0],n=r[1],o=n-a,e.outerClamp||(e.outerClamp=d3.max([e.innerClamp,o])),i=100-(e.paddingBottom+e.paddingTop),e.innerRange||(e.innerRange=i),c=d3.scale.linear().domain([e.innerClamp,e.outerClamp]).range([e.innerRange,i]).clamp(!0),s=c(o),l=e.paddingBottom+i/2,h=[l-s/2,l+s/2],u=d3.scale.linear().domain(r).range(h),[u.invert(0),u.invert(100)]
},closestOrdinalValue:function(t,e){var i,r,n,a,s,o,l;for(o=e.range(),r=n=0,a=o.length;a>n;r=++n)if(l=o[r],l>t||r===o.length-1?i=r:(s=o[r+1],s>t&&(i=s-t>t-l?r:r+1)),"number"==typeof i)return e.domain()[i]},getPathPositionAt:function(t,e){var i,r,n,a;for(n=e,i=t.getTotalLength(),a=null;;){if(a=Math.floor((n+i)/2),r=t.getPointAtLength(a),(a===i||a===n)&&r.x!==e)break;if(r.x>e)i=a;else{if(!(r.x<e))break;n=a}}return r},niceTimeTicks:function(t,e){var i,r,n;return n=t.map(function(t){return new Date(d3.round(1e3*t))}),i=d3.time.scale().domain(n),r=i.ticks(e),r.map(function(t){return t.getTime()/1e3})}}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.AreaLine=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.groupId("area"+Math.floor(1e3*Math.random())),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.filter=(new Strava.D3.Charts.DataFilter).graph(this)}var r;return t(i,e),r={builder:null,data:[],fill:!0,style:"area-chart-curr",interpolator:"",groupId:"",clipPathId:"",xOffset:0,xClipOffset:0,yOffset:0,startHidden:!1,xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),animate:null,cloneAreaToClipPath:!1},i.prototype.create=function(){var t,e,r;return i.__super__.create.call(this),this.animate(this.builder().animate()),r=this.builder().root,r.insert("defs",":first-child").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:this.builder().width()-this.xClipOffset()}),this.line=d3.svg.line().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.line.interpolate(this.interpolator()),this.area=d3.svg.area().x(function(t){return function(e){return t.xScale()(e.x)}}(this)).y0(this.builder().height()).y1(function(t){return function(e){return t.yScale()(e.y)}}(this)),""!==this.interpolator()&&this.area.interpolate(this.interpolator()),t=this.createContainer(),e=this.filter.filter(),t.selectAll("path#line").data([e]).enter().append("path").attr("id","line").attr("class",this.style()).attr("d",this.line),t.selectAll("path#area").data([e]).enter().append("path").attr("id","area").attr("class",this.style()+"-fill").attr("d",this.area),this.cloneAreaToClipPath()&&(r.insert("defs",":first-child").append("clipPath").attr({id:"master-"+this.clipPathId()}).append("rect").attr({x:0,y:-this.builder().height()+4,height:this.builder().height()-this.yOffset()+4,width:this.builder().width()-this.xClipOffset()}),this.clonedClipPath=r.append("defs",":first-child").append("clipPath").data([e]).attr({id:"child-"+this.clipPathId()}).attr({"clip-path":"url(#master-"+this.clipPathId()+")"}).append("path").attr("d",this.area).attr("transform","translate(0, -"+(this.builder().height()-1)+")")),this.startHidden()?this.hide():void 0},i.prototype.createContainer=function(){return this.builder().mainGroup.append("svg:g").attr({id:this.groupId(),"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")")},i.prototype.update=function(t){var e,i,r,n,a;return null==t&&(t=!0),t=this.shouldAnimate(t),r=this.builder().mainGroup.select("g#"+this.groupId()),n=this.filter.filter(),a=r.selectAll("path#line").data([n]),a=t?a.transition().duration(500).delay(0):a,a.attr("d",this.line),e=r.selectAll("path#area").data([n]),e=t?e.transition().duration(500).delay(0):e,e.attr("d",this.area),this.cloneAreaToClipPath()?(i=this.clonedClipPath.data([n]),i=t?e.transition().duration(500).delay(0):i,i.attr("d",this.area)):void 0},i.prototype.updateCanvas=function(){return this.builder().root.select("rect#"+this.clipPathId()).attr("width",this.builder().width()),this.update()},i.prototype.show=function(){return this.builder().mainGroup.select("#"+this.groupId()).attr("display","")},i.prototype.hide=function(){return this.builder().mainGroup.select("#"+this.groupId()).attr("display","none")},i.prototype.hidden=function(){return"none"===this.builder().mainGroup.select("#"+this.groupId()).attr("display")},i.prototype.getPositionAt=function(t){var e,i;return e=this.builder().mainGroup.select("g#"+this.groupId()),i=e.select("path#line").node(),Strava.D3.Charts.Util.getPathPositionAt(i,t)},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PlotGraph=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.groupId("plot"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,data:[],fillColor:null,style:"plot-graph",groupId:"",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100])},i.prototype.create=function(){var t,e;return i.__super__.create.call(this),t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.groupId()),e.selectAll(".point").data(this.data()).enter().append("circle").attr({stroke:"none",fill:this.fillColor(),"pointer-events":"all",r:2}).attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)).on("click",function(){})},i.prototype.update=function(){var t,e,i;return t=this.builder(),e=t.mainGroup.select("g#"+this.groupId()),i=e.selectAll("circle").data([this.data()]),i.enter().append("svg:circle").attr("stroke","none").attr("fill",this.fillColor()).attr("pointer-events","all").attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)).attr("r",3).on("click",function(){}),i.transition().duration(500).delay(0).attr("cx",function(t){return function(e){return t.xScale()(e.x)}}(this)).attr("cy",function(t){return function(e){return t.yScale()(e.y)}}(this)),i.exit().remove()},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Axis=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t),this.animate(t.animate()),this.xScale=d3.scale.linear().domain([0,0]).range([0,this.builder().width()]),this.yScale=d3.scale.linear().domain([0,0]).range([this.builder().height(),0]).nice(),this.clipPathId("clip"+Math.floor(1e3*Math.random())),this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.yScale).orient("left")}var r;return t(i,e),Strava.includeModule(i,Strava.chart_module),r={builder:null,selectedClass:"",clipPathId:"",xClipOffset:0,addClip:!1,animate:null},i.prototype.addClipRectangle=function(t){var e;return null==t&&(t={}),this.addClip()?(e={width:this.builder().width()-this.xClipOffset(),height:this.builder().height(),x:0,y:0},_.extend(e,t),this.builder().root.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:e.x,y:e.y,height:e.height,width:e.width}),this.builder().root.select("g#xaxis").attr("clip-path","url(#"+this.clipPathId()+")")):void 0},i.prototype.create=function(){var t,e;switch(t=this.builder(),t.yAxisOrientation()){case"left":e=t.padding().left;break;case"right":e=t.padding().left+t.width(),this.yAxis.orient("right")}return this.xAxis.tickFormat(t.context.xTickFormat()),this.yAxis.tickFormat(t.context.yTickFormat()),this.addAxis(t.root,this.xAxis,"xaxis","axis xaxis",t.padding().left,t.height()+t.padding().top),this.addClipRectangle(),this.addAxis(t.root,this.yAxis,"yaxis","axis yaxis",e,t.padding().top),this.bindEvents(),this},i.prototype.createYAxis2=function(t,e){var i,r;return i=this.builder(),i.root.select(".yaxis2").remove(),this.yScale2=e,this.yAxis2=d3.svg.axis().scale(e).orient("right").ticks(5).tickFormat(function(){return function(e){return i.context.getTickFormat(t,e)}}(this)),r=i.padding().left+i.width(),this.addAxis(i.root,this.yAxis2,"yaxis2","axis yaxis2",r,i.padding().top),this},i.prototype.createForBarChart=function(t,e,i,r){var n,a,s,o,l,u;return n=this.builder(),this.xScale=t,this.yScale=e,this.xAxis=d3.svg.axis().scale(t).orient("bottom"),this.xAxis.tickValues(i),this.addAxis(n.root,this.xAxis,"xaxis","axis xaxis",n.padding().left,n.height()+n.padding().top),this.addClipRectangle(),a=function(t){return(new Strava.I18n.TimespanFormatter).display(Math.round(t))},this.yAxis=d3.svg.axis().scale(e).orient("left").tickFormat(a).tickValues(r),this.addAxis(n.root,this.yAxis,"yaxis","axis yaxis",n.padding().left,n.padding().top),o=n.padding().left-35,u=n.padding().top-10,s="min"+n.context.getUnit("pace"),this.addAxisLabel(s,o,u),l=t.rangeExtent?t.rangeExtent()[1]:t.range()[1],o=n.padding().left+l+10,u=n.height()+n.padding().top+16,s=n.context.getUnit("pace").slice(1),this.addAxisLabel(s,o,u),this.bindEvents(),this},i.prototype.createForIntegratedChart=function(t,e,i,r,n){var a,s,o;return a=this.builder(),this.xScale=t,this.yScale=e,s=a.padding().left,o=a.padding().top+a.height(),this.xAxis=d3.svg.axis().scale(t).orient("bottom").tickValues(i),this.addAxis(a.root,this.xAxis,"xaxis","axis xaxis",s,o),n&&this.addClipRectangle(n),this.xAxisIntegrated=d3.svg.axis().scale(t).orient("bottom").tickValues(i).tickSize(-a.height(),0,0).tickFormat(""),this.addAxis(a.root,this.xAxisIntegrated,"xaxis-integrated","axis xaxis-integrated",s,o,n.clipPathId),this.yAxis=d3.svg.axis().scale(e).orient("left").tickValues(r),this.addAxis(a.root,this.yAxis,"yaxis","axis yaxis",a.padding().left,a.padding().top),this.bindEvents(),this},i.prototype.addAxisLabel=function(t,e,i){var r;return r=this.builder().topGroupDimensions(),i+=r.height,this.builder().root.append("svg:g").attr({"class":"axis text",transform:"translate("+e+", "+i+")","text-anchor":"left"}).append("text").text(t)},i.prototype.hideAxis=function(t){var e;return e=this.builder(),"x"===t?e.root.select("g.xaxis").attr("display","none"):e.root.select("g.yaxis").attr("display","none")},i.prototype.update=function(t){var e;return t=this.shouldAnimate(t),this.xAxis.scale(this.xScale),this.yAxis.scale(this.yScale),this.xAxisIntegrated&&this.xAxisIntegrated.scale(this.xScale),this.yAxis2&&this.yAxis2.scale(this.yScale2),e=this.builder(),t?(e.root.select("g.yaxis").transition().call(this.yAxis),e.root.select("g.xaxis").transition().call(this.xAxis),this.xAxisIntegrated&&e.root.select("g.xaxis-integrated").transition().call(this.xAxisIntegrated),this.yAxis2&&e.root.select("g.yaxis2").transition().call(this.yAxis2)):(e.root.select("g.yaxis").call(this.yAxis),e.root.select("g.xaxis").call(this.xAxis),this.xAxisIntegrated&&e.root.select("g.xaxis-integrated").call(this.xAxisIntegrated),this.yAxis2&&e.root.select("g.yaxis2").call(this.yAxis2)),this.bindEvents(),this},i.prototype.updateCanvas=function(){return this.builder().root.select("rect#"+this.clipPathId()).attr({width:this.builder().width()-this.xClipOffset()}),this.update()},i.prototype.zoom=function(t,e){return this.xScale.domain(t),this.yScale.domain(e),this.xAxis.ticks(5),this.update()},i.prototype.resetZoom=function(){return this.zoom(this.originalDomainX,this.originalDomainY)},i.prototype.bindEvents=function(){var t;return t=this.builder().root.selectAll(".xaxis text"),t.on("click",this.createHandler(function(e){return function(i,r){var n,a;return e.trigger("axisClick",e.xScale(r)),null!=e.selectedClass()&&e.selectedClass().length?(n=d3.select(i),a=n.classed(e.selectedClass()),t.classed(e.selectedClass(),!1),n.classed(e.selectedClass(),!a)):void 0}}(this)))},i.prototype.unbindEvents=function(){return this.builder().root.selectAll(".xaxis text").on("click",null)},i.prototype.clearAxisStyle=function(){return this.builder().root.selectAll(".xaxis text").classed(this.selectedClass(),!1)},i.prototype.getAxis=function(t){switch(t){case"x":return this.xAxis;case"y2":return this.yAxis2;case"xIntegrated":return this.xAxisIntegrated;default:return this.yAxis}},i.prototype.getAxisElement=function(t){switch(t){case"x":return this.builder().root.select(".xaxis");case"y2":return this.builder().root.select(".yaxis2");case"xIntegrated":return this.builder().root.select(".xaxis-integrated");default:return this.builder().root.select(".yaxis")}},i.prototype.getScale=function(t){switch(t){case"x":return this.xScale;case"y2":return this.yScale2;default:return this.yScale}},i.prototype.setScale=function(t,e){switch(t){case"x":this.xScale=e;break;case"y2":this.yScale2=e;break;default:this.yScale=e}return this},i.prototype.setScaleDomain=function(t,e){var i;return i=this.getScale(t),"x"===t?this.originalDomainX=e:this.originalDomainY=e,i.domain(e),this},i.prototype.setAxisTicks=function(t,e){var i;return i=this.getAxis(t),i.ticks(e),this},i.prototype.setScaleNice=function(t){var e;return e=this.getScale(t),e.nice(),this},i.prototype.addAxis=function(t,e,i,r,n,a,s){var o,l;return l=this.builder().topGroupDimensions(),o={"class":r,id:i,transform:"translate("+n+".5, "+(a+l.height)+".5)"},s&&(o["clip-path"]="url(#"+s+")"),t.append("svg:g").attr(o).call(e)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.InfoBox=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.contentCallback(t)}var r;return t(i,e),r={builder:null,fixed:!1,position:0,infobox:null,contentCallback:function(){},infobox:null,disabled:!1,lineHeight:16,boxWidth:150,xOffset:10,negativeXOffset:180,yOffset:20,textHeight:13,textTopPadding:5,textBottomPadding:15,textXOffset:10,allowFixedState:!0,containerWidth:null},i.prototype.create=function(){var t;return t=this.builder().mainGroup.append("svg:g").attr("id","infoBox"),this.infobox(t),this.infobox().append("rect").attr({x:0,y:this.yOffset(),width:this.boxWidth()}),this.containerWidth()||this.containerWidth(this.builder().width()),this},i.prototype.update=function(t){return this.disabled()?this.hide():(this.show(),this.fixed()?void 0:this.move(t))},i.prototype.move=function(t){var e,i,r,n,a;this.position(t),i=this.contentCallback()(t),t+this.boxWidth()+this.xOffset()>this.containerWidth()?(r=t-(this.boxWidth()+this.xOffset()),this.transitionGroup(r)):(r=t+this.xOffset(),this.transitionGroup(r)),this.infobox().selectAll("text").attr("display","none"),e=0;for(n in i)a=i[n],this.createText(n),e++,this.moveText(n,a,e);return this.infobox().select("rect").attr({height:""+(e*this.lineHeight()+this.textBottomPadding())})},i.prototype.transitionGroup=function(t){return this.infobox().attr({transform:"translate("+t+", 0)",display:""})},i.prototype.createText=function(t){var e;return e=this.infobox().select("text#infobox-text-"+t).node(),null==e?(e=this.infobox().append("text").attr({id:"infobox-text-"+t,x:this.textXOffset(),width:this.boxWidth(),height:this.textHeight(),"pointer-events":"none"}),e.append("tspan").attr({"class":"title","pointer-events":"none"}),e.append("tspan").attr({"class":"value","pointer-events":"none"})):void 0},i.prototype.updateText=function(){return this.fixed()?this.move(this.position()):void 0},i.prototype.moveText=function(t,e,i){var r;return r=this.infobox().select("text#infobox-text-"+t).attr({y:""+(i*this.lineHeight()+this.textTopPadding()+this.yOffset()),x:this.textXOffset(),display:""}),r.select(".title").text(e.title+": "),r.select(".value").attr("font-weight","bold").text(""+e.val)},i.prototype.toggleFixedState=function(){return!this.disabled()&&this.allowFixedState()?this.fixed(!this.fixed()):void 0},i.prototype.forceFixedState=function(t){return!this.disabled()&&this.allowFixedState()?this.position()===t&&this.fixed()?(this.fixed(!1),this.hide()):(this.fixed(!0),this.show(),this.move(t)):void 0},i.prototype.hide=function(){return this.fixed()?void 0:this.infobox().attr("display","none")},i.prototype.show=function(){return this.infobox().attr("display","")},i.prototype.disable=function(){return this.disabled(!0),this.fixed(!1),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.zoom=function(){},i.prototype.resetZoom=function(){},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["activities/pointInfoBox"]=function(t){return function(){var t,e,i,r,n,a;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<ul class='point-on-path-box-items'>"),a=this.items;for(r in a)n=a[r],i.push("  <li class='point-on-path-box-item point-on-path-box-item"+n.title.toLowerCase().replace(/\W/,"")+"'>\n    <span class='point-on-path-box-item-label'>"+e(t(n.title))+"</span>"),i.push("    "+e(t(n.val))),i.push("  </li>");return i.push("</ul>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PointInfoBox=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.contentCallback(t),this.alignObject=e}var r;return t(i,e),r={builder:null,contentCallback:function(){},disabled:!1,xOffset:0,yOffset:20,containerWidth:null,containerHeight:null,crossBarClassName:"smooth-pace-info-crossbar",pointClassName:"smooth-pace-info-point",pointBoxClassName:"point-on-path-box",token:Math.floor(1e3*Math.random()),pointRadius:3.5,yThreshold:500,yFloor:null,visible:!1,container:null},i.prototype.create=function(){return this.flexibleTextBox=this.$$("<div></div>").attr("class",this.pointBoxClassName()).attr("id",this.pointBoxClassName()+"-"+this.token()).append(JST["activities/pointInfoBox"]({items:[]})),this.flexibileCrossBar=this.builder().mainGroup.append("line").attr("id",this.crossBarClassName()+"-"+this.token()).attr("class",this.crossBarClassName()).attr("x1",100).attr("y1",this.yOffset()).attr("x2",100).attr("y2",200).style("opacity",0),this.container().append(this.flexibleTextBox),this.flexibleTextBox=this.$$("#"+this.pointBoxClassName()+"-"+this.token()),this.yFloor(this.yFloor()+this.yThreshold()),this.c=this.builder().mainGroup.append("svg:circle").attr("class",this.pointClassName()).attr("id",this.pointClassName()+"-"+this.token()).attr("r",0).attr("stroke","#4788b9").style("opacity",0),this},i.prototype.update=function(t,e){return this.disabled()?this.hide():this.visible()?(this.move(t,e),this.show()):void 0},i.prototype.move=function(t,e){var i,r,n,a;return r=this.contentCallback()(t),n=this.alignObject.getPositionAt(t),e<this.yFloor()?(this.updateText(JST["activities/pointInfoBox"]({items:r})),a=this.flexibleTextBox.outerWidth(),i=this.flexibleTextBox.height()+2,this.moveTextBox(t+a+this.xOffset()>this.containerWidth()+this.xOffset()?this.containerWidth()-a+this.xOffset():t+this.xOffset()),this.moveCrossBar(t,i,this.containerHeight()),this.movePoint(t,n.y),this.show()):this.hide()},i.prototype.moveCrossBar=function(t,e,i){return this.flexibileCrossBar.attr("x1",t).attr("x2",t).attr("y1",e).attr("y2",i)},i.prototype.movePoint=function(t,e){return this.c.attr("transform","translate("+t+","+e+")")},i.prototype.updateText=function(t){return this.flexibleTextBox.html(t)},i.prototype.moveTextBox=function(t){var e;return e=/Constructor/.test(window.HTMLElement)?-1:0,this.flexibleTextBox.css({left:t+e+"px",top:this.yOffset()+"px"})},i.prototype.hide=function(){return this.visible()?(this.c.transition().duration(100).attr("r",0).style("opacity",0),this.flexibileCrossBar.style("opacity",0),this.flexibleTextBox.removeClass("point-on-path-box-visible"),this.visible(!1)):void 0},i.prototype.show=function(){return this.visible()===!1&&this.disabled()===!1?(this.c.transition().duration(100).attr("r",this.pointRadius()).style("opacity",1),this.flexibileCrossBar.style("opacity",1),this.flexibleTextBox.addClass("point-on-path-box-visible"),this.visible(!0)):void 0},i.prototype.disable=function(){return this.disabled(!0),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["controls/scrollBar"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+this.className+"' id='"+this.id+"' style='"+e(t(this.size))+"'>\n  <div class='"+this.gutterClassName+"'></div>\n  <div class='"+this.gripClassName+"'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.ScrollBar=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.context(t),this.builder(e),this.className(this.baseClassName()+" "+this.style()+" "+this.baseClassName()+"-"+this.type()),this.id(this.baseClassName()+"-"+this.token())}var r;return t(i,e),Strava.includeModule(i,Strava.chart_module),r={context:null,builder:null,container:null,type:"horizontal",baseClassName:"s-scrollbar",style:"",id:null,className:null,disabled:!1,token:Math.floor(1e3*Math.random()),hideWhenNotNeeded:!0,body:null,gripClassName:"s-scrollbar-grip",gutterClassName:"s-scrollbar-gutter",grip:null,gutter:null,scrollBar:null,isVisible:!1,size:null,minimalGripSize:20,contentSize:0,windowSize:0,gutterSize:0,gripSize:0,windowContentRatio:0,windowScrollAreaSize:0,windowPosition:0,windowPositionRatio:0,trackScrollAreaSize:0,gripPositionOnTrack:0,mousePosition:0,containerOffset:{}},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),this.body(this.$$("body")),r="horizontal"===this.type()?"width":"height",i={id:this.id(),className:this.className(),size:r+": "+this.size()+"px;",gutterClassName:this.gutterClassName(),gripClassName:this.gripClassName()},e=JST["controls/scrollBar"](i),this.container().append(e),this.scrollBar(this.$$("#"+this.id())),this.grip(this.$$("#"+this.id()+" ."+this.gripClassName())),this.gutter(this.$$("#"+this.id()+" ."+this.gutterClassName())),this.containerOffset(this.container().offset()),this.windowSize(this.size()),this.gutterSize(this.windowSize()),this.scaleComponents(this.gripPositionOnTrack()),this.bindEvents()},i.prototype.scaleComponents=function(t){var e,i;return this.windowScrollAreaSize(this.contentSize()-this.windowSize()),this.windowContentRatio(this.windowSize()/this.contentSize()),this.gripSize(Math.round(this.gutterSize()*this.windowContentRatio())),this.gripSize()<this.minimalGripSize()?this.gripSize(this.minimalGripSize()):this.gripSize()>=this.size()?(this.gripSize(this.size()),this.windowPosition(0),this.hideWhenNotNeeded()&&this.hide(),this.trigger("noContentAvailable",this)):this.show(),"horizontal"===this.type()?this.grip().css("width",this.gripSize()+"px"):this.grip().css("height",this.gripSize()+"px"),this.trackScrollAreaSize(this.gutterSize()-this.gripSize()),e=t,this.gripPositionOnTrack()>this.trackScrollAreaSize()&&(e=this.trackScrollAreaSize()),this.positionGrip(e,!0),i=this.gripPositionOnTrack()/this.trackScrollAreaSize(),this.positionWindow(i*this.windowScrollAreaSize())},i.prototype.positionWindow=function(t,e){var i;return null==e&&(e=!1),this.windowPosition(t),i=this.windowPosition()/this.windowScrollAreaSize(),1===i&&this.trigger("atContentEnd",this),0===i&&this.trigger("atContentStart",this),i>0&&1>i?(this.trigger("contentAvailableStart",this),this.trigger("contentAvailableEnd",this)):void 0},i.prototype.positionGrip=function(t,e){var i,r;return null==e&&(e=!1),this.gripPositionOnTrack(t),i="horizontal"===this.type()?"left":"top",e===!1?this.grip().css(i,this.gripPositionOnTrack()+"px"):(r={},r[i]=this.gripPositionOnTrack()+"px",this.grip().animate(r,200))},i.prototype.bindEvents=function(){return this.grip().on("mousedown.scrollBar"+this.token(),function(t){return function(e){return t.handleStart(e)}}(this)),this.gutter().on("click.scrollBar"+this.token(),function(t){return function(e){return t.handleGutterPositioning(e)}}(this))},i.prototype.handleGutterPositioning=function(t){var e,i;return t.preventDefault(),i=t.pageX-this.gutter().offset().left,i<this.gripPositionOnTrack()&&this.positionGrip(i,!0),i>this.gripPositionOnTrack()+this.gripSize()&&(i-this.gripSize()>this.trackScrollAreaSize()?this.positionGrip(this.trackScrollAreaSize(),!0):this.positionGrip(i-this.gripSize(),!0)),e=this.gripPositionOnTrack()/this.trackScrollAreaSize(),this.positionWindow(e*this.windowScrollAreaSize()),this.trigger("change",this,t)},i.prototype.handleChange=function(t){var e,i,r;return t.preventDefault(),"horizontal"===this.type()?(e=t.pageX-this.containerOffset().left-this.mousePosition(),this.mousePosition(t.pageX-this.containerOffset().left)):(e=t.pageY-this.containerOffset().top-this.mousePosition(),this.mousePosition(t.pageY-this.containerOffset().top)),i=this.gripPositionOnTrack()+e,0>i&&(i=0),i>this.trackScrollAreaSize()&&(i=this.trackScrollAreaSize()),this.positionGrip(i),r=i/this.trackScrollAreaSize(),this.positionWindow(r*this.windowScrollAreaSize()),this.trigger("change",this,t)},i.prototype.handleStart=function(t){var e;return t.preventDefault(),this.disabled()?void 0:(this.mousePosition("horizontal"===this.type()?t.pageX-this.containerOffset().left:t.pageY-this.containerOffset().top),this.scrollBar().addClass(this.baseClassName()+"-dragging"),e=this.body(),e.on("mousemove.scrollBar"+this.token(),function(t){return function(e){return t.handleChange(e)}}(this)),e.on("mouseup.scrollBar"+this.token(),function(t){return function(e){return t.handleEnd(e)}}(this)),e.addClass("interaction-grabbing"),this.trigger("start",this,t))},i.prototype.handleEnd=function(t){var e;return this.scrollBar().removeClass(this.baseClassName()+"-dragging"),e=this.body(),e.off("mousemove.scrollBar"+this.token()),e.off("mouseup.scrollBar"+this.token()),e.removeClass("interaction-grabbing"),this.trigger("end",this,t)},i.prototype.update=function(t,e){return e||(e=this.gripPositionOnTrack()),this.contentSize(t),this.scaleComponents(e),this.trigger("change",this)},i.prototype.disable=function(){return this.disabled(!0),this.scrollBar().addClass(this.baseClassName()+"-disabled"),this.trigger("disable",this)},i.prototype.enable=function(){return this.disabled(!1),this.scrollBar().removeClass(this.baseClassName()+"-disabled"),this.trigger("enable",this)},i.prototype.hide=function(){return this.disable(),this.scrollBar().addClass(this.baseClassName()+"-hidden"),this.isVisible(!1),this.trigger("hide",this)},i.prototype.show=function(){return this.enable(),this.scrollBar().removeClass(this.baseClassName()+"-hidden"),this.isVisible(!0),this.trigger("show",this)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Filter=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.builder(t),this.id(e)}var r;return t(i,e),r={builder:null,id:"filter",height:"200%",width:"200%",originX:"-20%",originY:"-20%"},i.prototype.DEFAULTS={basicShadow:{x:1,y:1,blur:10,opacity:10}},i.prototype.basicShadow=function(t,e){var i,r,n;return e=_.extend({},this.DEFAULTS.basicShadow,e),n=this.builder().root,i=n.append("defs").append("filter").attr("id",this.id()).attr("height",this.height()).attr("x",this.originX()).attr("y",this.originY()).attr("width",this.width()),i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e.blur),i.append("feOffset").attr("dx",e.x).attr("dy",e.y).attr("result","offsetBlur"),i.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",e.opacity),r=i.append("feMerge"),r.append("feMergeNode"),r.append("feMergeNode").attr("in","SourceGraphic"),d3.select(t).attr("filter","url(#"+this.id()+")")},i}(Strava.D3.Charts.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.CrossBar=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.convertToTitle(t)}var r;return t(i,e),r={crossBarStyle:"crossbar",builder:null,fixed:!1,position:0,boxWidth:150,xOffset:10,negativeXOffset:180,textXOffset:0,textYOffset:15,convertToTitle:function(){},disabled:!1,allowFixedState:!0,containerWidth:null,groupName:"crossBar"},i.prototype.create=function(){var t,e;return t=this.builder(),e=t.mainGroup.append("svg:g").attr("id",this.groupName()),e.append("line").attr({x1:0,x2:0,y1:t.height(),y2:0,"class":this.crossBarStyle(),display:"none"}),e.append("text").attr({x:this.textXOffset(),y:this.textYOffset(),"class":"crossbar-text","text-anchor":"left",display:"none","pointer-events":"none"}),this.containerWidth()||this.containerWidth(this.builder().width()),this},i.prototype.update=function(t){return this.disabled()?this.hide():(this.show(),this.fixed()?void 0:this.move(t))},i.prototype.move=function(t){var e;return this.position(t),e=t+this.boxWidth()+this.xOffset()>this.containerWidth()?t-(this.boxWidth()+this.xOffset()):t+this.xOffset(),this.getBar().attr({x1:t-.5,x2:t-.5,display:"","class":this.crossBarStyle()}),this.getTitle().attr({x:e+this.textXOffset(),display:""}).text(this.convertToTitle()(t))},i.prototype.toggleFixedState=function(){var t;if(!this.disabled()&&this.allowFixedState())return this.fixed(!this.fixed()),t=this.crossBarStyle(),this.fixed()?t="crossbar crossbar-clicked":this.builder().axis().clearAxisStyle(),this.getBar().attr("class",t)},i.prototype.forceFixedState=function(t){return!this.disabled()&&this.allowFixedState()?this.position()===t&&this.fixed()?(this.fixed(!1),this.hide()):(this.fixed(!0),this.show(),this.move(t),this.getBar().attr("class","crossbar crossbar-clicked")):void 0},i.prototype.hide=function(){var t;return this.fixed()?void 0:(t=this.builder().mainGroup.select("g#"+this.groupName()),t.attr("display","none"))},i.prototype.disable=function(){return this.disabled(!0),this.fixed(!1),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i.prototype.show=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.attr("display","")},i.prototype.getBar=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.selectAll("line")},i.prototype.getTitle=function(){var t;return t=this.builder().mainGroup.select("g#"+this.groupName()),t.selectAll("text")},i.prototype.zoom=function(){},i.prototype.resetZoom=function(){},i.prototype.updateCanvas=function(){return this.containerWidth(this.builder().width())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.BarCallout=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.getSplitIdFromX(t),this.getSplitData(e)}var r;return t(i,e),r={builder:null,callout:null,getSplitIdFromX:function(){},getSplitData:function(){},callout:null,disabled:!1,lineHeight:16,boxWidth:150,xOffset:0,yOffset:0,textHeight:13,textTopPadding:5,textBottomPadding:15,textXOffset:25,xScale:null,yScale:null,fixed:!1},i.prototype.create=function(){var t;return t=this.builder().mainGroup.append("svg:g").attr({id:"callout","class":"tooltip-group"}),this.callout(t),this.callout().append("rect").attr({fill:"#F5F5F5","fill-opacity":".95","stroke-width":".1",stroke:"#000000",width:this.boxWidth(),"pointer-events":"none","class":"chart-tooltip"}),this
},i.prototype.updateFromGridEvent=function(t){var e;if(!this.fixed())return e=this.getSplitIdFromX()(t),e?this.update(e):void 0},i.prototype.updateFromBarEvent=function(t){return this.fixed()?void 0:this.update(t)},i.prototype.fixedAt=function(t){return this.fixed(!0),this.forceUpdate(t)},i.prototype.forceUpdate=function(t){return this.update(t)},i.prototype.update=function(t){var e;return this.disabled()?this.hide():(this.show(),e=this.getSplitData()(t),this.showCallout(e),this.highlightBar(e))},i.prototype.highlightBar=function(t){return this.builder().graphs().paceAnalysisBars.unHighlightSplits(),this.builder().graphs().paceAnalysisBars.highlightSplit(t.split.index)},i.prototype.showCallout=function(t){var e,i,r,n,a,s,o,l,u;i=t.streams,n=t.split,u=this.xScale()(n.label),o=Math.round(this.yScale()(n.y))+this.yOffset()-this.textBottomPadding()-this.textTopPadding(),l=this.builder().graphs().paceAnalysisBars.width(),u+this.boxWidth()>l?(r={x:Math.min(u,l)-this.boxWidth(),y:o},this.transitionGroup(r)):(r={x:Math.max(u,0),y:o},this.transitionGroup(r)),e=0;for(a in i)s=i[a],this.createText(a),e++,this.moveText(a,s,e);return this.callout().select("rect").attr({height:""+(e*this.lineHeight()+this.textBottomPadding())})},i.prototype.transitionGroup=function(t){return this.callout().attr({transform:"translate("+t.x+", "+t.y+")",display:""})},i.prototype.createText=function(t){var e;return e=this.callout().select("text#callout-text-"+t).node(),null==e?(e=this.callout().append("text").attr({id:"callout-text-"+t,x:this.textXOffset(),width:this.boxWidth(),height:this.textHeight(),"pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-label","pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-value","pointer-events":"none"}),e.append("tspan").attr({"class":"chart-tooltip-unit","pointer-events":"none"})):void 0},i.prototype.moveText=function(t,e,i){var r;return r=this.callout().select("text#callout-text-"+t).attr({y:""+(i*this.lineHeight()+this.textTopPadding()),x:this.textXOffset(),display:""}),r.select(".chart-tooltip-label").text(e.title+": "),r.select(".chart-tooltip-value").text(""+e.val),r.select(".chart-tooltip-unit").text(""+e.label),this},i.prototype.hide=function(){return this.fixed()?void 0:this.callout().attr("display","none")},i.prototype.show=function(){return this.callout().attr("display","")},i.prototype.disable=function(){return this.fixed(!1),this.disabled(!0),this.hide()},i.prototype.enable=function(){return this.disabled(!1)},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.PartialAreaLine=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.segmentClipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={startIndex:0,endIndex:-1,extentConvertor:null,segmentClipPathId:""},i.prototype.create=function(){return i.__super__.create.call(this),this.hide(!1)},i.prototype.createContainer=function(){var t,e;return this.builder().root.insert("defs",":first-child").append("clipPath").attr({id:this.segmentClipPathId()}).append("rect").attr({id:this.segmentClipPathId(),x:0,y:-4,height:this.builder().height()-this.yOffset()+4,width:0}),t=this.builder().mainGroup.append("svg:g").attr({"clip-path":"url(#"+this.clipPathId()+")"}).attr("transform","translate("+this.xOffset()+","+this.yOffset()+")"),e=t.append("svg:g").attr({id:this.groupId(),"clip-path":"url(#"+this.segmentClipPathId()+")"})},i.prototype.extent=function(){var t,e,i,r;return i=null!=this.startIndex()?this.startIndex():0,t=null==this.endIndex()||-1===this.endIndex()?this.data().length-1:this.endIndex(),null!=this.extentConvertor()?this.extentConvertor()(this.xScale(),i,t):(r=this.xScale()(this.data()[i].x),e=this.xScale()(this.data()[t].x),[r,e])},i.prototype.update=function(t){var e,r,n,a;return null==t&&(t=!0),i.__super__.update.call(this,t),t=this.shouldAnimate(t),e=this.builder(),r=this.extent(),n=e.root,a=n.select("rect#"+this.segmentClipPathId()),a=t?a.transition().duration(500).delay(0):a,a.attr({x:r[0],y:0,height:e.height()-this.yOffset(),width:r[1]-r[0]})},i.prototype.hide=function(t){var e;return null==t&&(t=!0),t=this.shouldAnimate(t),e=this.builder().root.select("rect#"+this.segmentClipPathId()),e=t?e.transition().delay(0):e,e.attr("width",0)},i.prototype.show=function(){return this.update(!1)},i.prototype.resetZoom=function(){return i.__super__.resetZoom.call(this,!1),this.hide(!1)},i}(Strava.D3.Charts.AreaLine)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.DraggableRect=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.origin=0}var r;return t(i,e),r={builder:null,data:[],xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),mod:0},i.prototype.create=function(){var t,e,i,r;return t=this.builder(),i=this.createHandler(function(e){return function(i){var r;return r=d3.event.x,0>=r&&(r=0),r+t.width()/e.mod()>=t.width()&&(r=t.width()-t.width()/e.mod()),d3.select(i).attr("x",r),e.trigger("dragmove",r,Math.round(r+t.width()/e.mod()))}}(this)),e=d3.behavior.drag().origin(function(t){return function(){return{x:t.origin,y:0}}}(this)).on("drag",i).on("dragend",this.createHandler(function(t){return function(e){var i,r,n;return t.origin=parseInt(d3.select(e).attr("x"),10),r=t.getBounds(),n=r[0],i=r[1],t.trigger("dragend",n,i)}}(this))),r=t.mainGroup.append("svg:g").attr("id","drag-rect"),r.append("rect").attr({x:0,y:0,height:t.height(),style:"cursor: move",width:0,"class":"drag-rect"}).call(e).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return i=d3.mouse(e),r=i[0],n=i[1],r>t.builder().width()?void 0:t.trigger("mousemove",r,n)}}(this))).on("mouseout",this.createHandler(function(t){return function(){return t.trigger("mouseout")}}(this)))},i.prototype.update=function(t){var e,i,r,n,a;return e=this.builder(),r=e.mainGroup.select("#drag-rect"),this.mod(Math.pow(2,t)),this.origin=e.width()/2-e.width()/this.mod()/2,r.select("rect").attr("height",e.height()),r.select("rect").transition().duration(300).attr({width:e.width()/this.mod(),x:this.origin,opacity:1}),n=this.getBounds(),a=n[0],i=n[1],this.trigger("initiateZoom",a,i)},i.prototype.getBounds=function(){return[this.origin,Math.round(this.origin+this.builder().width()/this.mod())]},i.prototype.isVisible=function(){var t;return t=this.builder().mainGroup.select("#drag-rect").select("rect"),null!=t[0]&&null!=t.attr("opacity")&&0!==parseInt(t.attr("opacity"),10)},i.prototype.hide=function(){return this.builder().mainGroup.select("#drag-rect").select("rect").transition().delay(0).attr({width:this.builder().width(),opacity:0,x:0}).each("end",function(){return d3.select(this).attr("height",0)}),this.trigger("initiateZoom",0,this.builder().width())},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Brush=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r)}var r;return t(i,e),r={builder:null,xScale:d3.scale.linear().domain([1,10]).range([0,100]),id:"brush"},i.prototype.create=function(){return this.brush=d3.svg.brush().x(this.xScale()).on("brush",function(t){return function(){return _.throttle(t.brushEvent(),100)}}(this)).on("brushend",function(t){return function(){return t.brush.empty()?t.trigger("click"):t.brushEndEvent()}}(this)),this.builder().mainGroup.append("svg:g").attr("id",""+this.id()).call(this.brush).selectAll("rect").attr("height",this.builder().height()).on("mousemove",this.createHandler(function(t){return function(e){var i,r,n;return t.insideBrushEvent(d3.event.currentTarget)?(i=d3.mouse(e),r=i[0],n=i[1],t.trigger("mousemove",r,n)):void 0}}(this))).on("mouseout",this.createHandler(function(t){return function(e){return t.trigger("mouseout",e)}}(this))),this},i.prototype.rebuildBrush=function(){return this.brush.x(this.xScale()),this.builder().mainGroup.selectAll("#brush").call(this.brush)},i.prototype.setExtent=function(t){return this.brush?(this.brush.extent(t),this.rebuildBrush()):void 0},i.prototype.getExtent=function(){return this.brush&&!this.brush.empty()?this.brush.extent():void 0},i.prototype.clearExtent=function(){return this.brush?(this.brush.clear(),this.rebuildBrush()):void 0},i.prototype.brushEvent=function(){var t;return this.brush.empty()?this.trigger("empty"):(t=this.brush.extent(),t[0]===t[1]?this.trigger("empty"):this.trigger("change",t))},i.prototype.brushEndEvent=function(){return this.brush.empty()?void 0:this.trigger("stop",this.brush.extent())},i.prototype.insideBrushEvent=function(t){var e;return e=jQuery(t),e.closest(".background").length>0||e.closest(".extent").length>0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Marker=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.id("marker"+Math.floor(1e3*Math.random())),this.clipPathId("clip"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={builder:null,id:"",clipPathId:"",xScale:d3.scale.linear().domain([1,10]).range([0,100]),yScale:d3.scale.linear().domain([1,10]).range([0,100]),style:"marker",radius:50,textGenerator:function(){},xClipOffset:0,data:[],finishWidth:100,yFlagOffset:0},i.prototype.deltas=function(){var t,e;return t=[],e=null,this.data().forEach(function(i,r){return i.isHalfMarathon||i.isFinish?void 0:(0!==r&&t.push({time:i.time-e.time,distance:e.x+(i.x-e.x)/2,startDistance:e.x,endDistance:i.x}),e=i)}),t},i.prototype.render=function(){var t,e,i,r,n,a,s,o,l,u,h,c,p,d,f;for(t=this.builder(),f=t.topGroupDimensions(),i=function(){var t,i,r,n;for(r=this.data(),n=[],t=0,i=r.length;i>t;t++)e=r[t],e.isFinish||n.push(e);return n}.call(this),t.topGroup.append("defs").append("clipPath").attr({id:this.clipPathId()}).append("rect").attr({id:this.clipPathId(),x:0,y:0,height:t.height()+f.height,width:t.width()-this.xClipOffset()}),s=t.topGroup.append("svg:g").attr({id:this.id(),"clip-path":"url(#"+this.clipPathId()+")",opacity:0}),s.selectAll("line.vertical").data(i).enter().append("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this),y2:2*this.radius(),y1:t.height()+f.height,"class":"vertical "+this.style()}),n=this.style()+"-distance",d=this.style()+"-time",p=this.style()+"-small-time",c=this.style()+"-small-time-container",r=this.deltas(),s.selectAll("g.timeLine").data(r).enter().append("svg:g").attr("class","timeLine"),s.selectAll("g.timeLine").append("line").attr({x1:function(t){return function(e){return t.xScale()(e.startDistance)}}(this),x2:function(t){return function(e){return t.xScale()(e.endDistance)}}(this),y1:this.radius(),y2:this.radius(),"class":"time "+this.style()}),s.selectAll("g.timeLine").append("rect").attr({x:function(t){return function(e){return t.xScale()(e.distance)-19}}(this),y:this.radius()-7,width:38,height:14,"class":c}),s.selectAll("g.timeLine").append("text").attr({x:function(t){return function(e){return t.xScale()(e.distance)}}(this),y:function(t){return function(){return t.radius()+5}}(this),"class":p}).text(this.createHandler(function(){return function(t,e){return(new Strava.I18n.TimespanFormatter).display(e.time)}}(this))),s.selectAll("g.circle").data(i).enter().append("svg:g").attr("class","circle"),s.selectAll("g.circle").append("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this),cy:function(t){return function(e){return e.isHalfMarathon?3*t.radius():t.radius()}}(this),r:this.radius(),"class":this.style()}),s.selectAll("g.circle").append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return e.isHalfMarathon?3*t.radius()+13:t.radius()+13}}(this),"class":n}).text(this.createHandler(function(t){return function(e,i){var r;return r=t.textGenerator()(i),r.distance}}(this))),s.selectAll("g.circle").append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this),y:function(t){return function(e){return e.isHalfMarathon?3*t.radius():t.radius()}}(this),"class":d}).text(this.createHandler(function(t){return function(e,i){var r;return r=t.textGenerator()(i),r.time}}(this))),h=this.data(),l=0,u=h.length;u>l;l++)e=h[l],e.isFinish&&(a=e);return t.topGroup.selectAll("g.finish").data([a]).enter().append("svg:g").attr({"class":"finish","clip-path":"url(#"+this.clipPathId()+")"}),o=t.topGroup.selectAll("g.finish"),this.yFlagOffset(2*this.radius()),o.append("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this),y2:this.yFlagOffset(),y1:t.height()+f.height,"class":"vertical "+this.style()+"-finish-pole"}),o.append("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this),cy:this.yFlagOffset(),r:4,"class":this.style()+"-finish-top"}),o.append("polygon").attr({points:function(t){return function(e){var i;return i=t.xScale()(e.x),t.getFlagPoints(i)}}(this),"class":this.style()+"-finish-flag"}),o.append("text").attr({x:function(t){return function(e){return t.xScale()(e.x)+50-t.finishWidth()}}(this),y:3*this.radius()+5,"class":this.style()+"-finish-time"}).text(this.createHandler(function(){return function(t,e){return(new Strava.I18n.TimespanFormatter).display(e.time)}}(this))),this},i.prototype.show=function(t){var e,i;return i="g#"+this.id(),e=t?t.select(i):this.builder().topGroup.select(i),e.attr("opacity",1)},i.prototype.update=function(){var t,e,i,r,n,a;return t=this.style()+"-distance",a=this.style()+"-time",n=this.style()+"-small-time",r=this.style()+"-small-time-container",i=this.builder().topGroup.select("g#"+this.id()),i.selectAll("line.vertical").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("text."+a).attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("rect."+r).attr({x:function(t){return function(e){return t.xScale()(e.distance)-19}}(this)}),i.selectAll("text."+t).attr({x:function(t){return function(e){return t.xScale()(e.x)}}(this)}),i.selectAll("text."+n).attr({x:function(t){return function(e){return t.xScale()(e.distance)}}(this)}),i.selectAll("line.time").attr({x1:function(t){return function(e){return t.xScale()(e.startDistance)}}(this),x2:function(t){return function(e){return t.xScale()(e.endDistance)}}(this)}),e=this.builder().topGroup.select("g.finish"),e.selectAll("circle").attr({cx:function(t){return function(e){return t.xScale()(e.x)}}(this)}),e.selectAll("line").attr({x1:function(t){return function(e){return t.xScale()(e.x)}}(this),x2:function(t){return function(e){return t.xScale()(e.x)}}(this)}),e.selectAll("text").attr({x:function(t){return function(e){return t.xScale()(e.x)+50-t.finishWidth()}}(this)}),e.selectAll("polygon").attr({points:function(t){return function(e){var i;return i=t.xScale()(e.x),t.getFlagPoints(i)}}(this),"class":this.style()+"-finish-flag"})},i.prototype.getFlagPoints=function(t){var e;return e=[],e.push(t+","+(this.yFlagOffset()+10)),e.push(t-this.finishWidth()+","+(this.yFlagOffset()+10)),e.push(t-this.finishWidth()+10+","+(this.yFlagOffset()+26)),e.push(t-this.finishWidth()+","+(this.yFlagOffset()+43)),e.push(t+","+(this.yFlagOffset()+43)),e.join(" ")},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.D3.Charts"),Strava.D3.Charts.Builder=function(e){function i(t){i.__super__.constructor.call(this),this.initializeAttributes(r),this.context=t,this.mainId("main-container-"+Math.floor(1e3*Math.random())),this.topId("top-container-"+Math.floor(1e3*Math.random()))}var r;return t(i,e),r={selector:".base-chart",width:868,height:250,padding:{top:0,bottom:20,right:40,left:60},topArea:{height:110,width:868},topAreaHidden:!0,gridClass:Strava.D3.Charts.Grid,lineClass:Strava.D3.Charts.Line,plotGraphClass:Strava.D3.Charts.PlotGraph,crossBarClass:Strava.D3.Charts.CrossBar,infoBoxClass:Strava.D3.Charts.InfoBox,pointInfoBoxClass:Strava.D3.Charts.PointInfoBox,scrollBarClass:Strava.D3.Charts.ScrollBar,filterClass:Strava.D3.Charts.Filter,barCalloutClass:Strava.D3.Charts.BarCallout,barClass:Strava.D3.Charts.BarChart,barChartKeyClass:Strava.D3.Charts.BarChartKey,areaClass:Strava.D3.Charts.AreaLine,partialAreaClass:Strava.D3.Charts.PartialAreaLine,axisClass:Strava.D3.Charts.Axis,draggableRectClass:Strava.D3.Charts.DraggableRect,brushClass:Strava.D3.Charts.Brush,axis:null,grid:null,eventDispatcher:null,graphs:{},splitCrossBars:{},mainId:null,topId:null,yAxisOrientation:"left",yAxisTicks:5,xAxisTicks:10,animate:null,yAxisSnap:20,controls:{},responsive:!1},i.prototype.build=function(t){var e,i,r,n,a;return this.axis()||this.axis(new this._axisClass(this)),this.grid(new this._gridClass(this)),e=this.$(this.selector(),t)[0],n=this.topGroupDimensions(),a=this.width()+(this.padding().right+this.padding().left),i=this.height()+n.height+(this.padding().top+this.padding().bottom),this.root=d3.select(e).append("svg"),this.root.attr(this.responsive()?{width:"100%",height:i,viewBox:"0 0 "+a+" "+i,preserveAspectRatio:"xMinYMinmeet"}:{width:a,height:i}),this.topAreaHidden()||(this.topGroup=this.root.append("svg:g").attr({id:this.topId(),transform:"translate("+this.padding().left+", "+this.padding().top+")","class":"topGroup"})),r=this.padding().top+n.height,this.mainGroup=this.root.append("svg:g").attr("class","chartGroup").attr("id",this.mainId()).attr("transform","translate("+this.padding().left+", "+r+")"),this},i.prototype.topGroupDimensions=function(){return this.topAreaHidden()?{height:10,width:0}:this.topArea()},i.prototype.buildAxis=function(){return this.axis().create(),this},i.prototype.buildGrid=function(t){return null==t&&(t=function(){}),t(this.grid()),this.grid().create(),this},i.prototype.buildLine=function(t,e,i,r,n,a){var s;return null==r&&(r="generic-line"),null==n&&(n="basis-open"),null==a&&(a=function(){}),s=new this._lineClass,s.builder(this).data(t).id(r).xScale(e).yScale(i).interpolator(n),a(s),s.create(),this.graphs()[r]=s,this},i.prototype.setEventDispatcher=function(t){return this.eventDispatcher(t),this.grid().bind("mousemove",function(t){return function(e,i){return t.handleGridMouseMove(e,i)}}(this)).bind("gridclick",function(t){return function(e,i){return t.handleGridClick(e,i)}}(this)).bind("gridout",function(t){return function(e,i){return t.handleGridOut(e,i)}}(this)),t.addListener(this,this),this},i.prototype.buildPaceBarCallout=function(t,e,i,r,n,a){return null==a&&(a=function(){}),this.paceBarCallout=new this._barCalloutClass(r,n),this.paceBarCallout.builder(this).xScale(t).yScale(e).create(),a(this.paceBarCallout),this.grid().bind("mousemove",function(t){return function(e,i){return t.paceBarCallout.updateFromGridEvent(e,i)}}(this)).bind("gridout",function(t){return function(){return t.paceBarCallout.hide()}}(this)),this.graphs().paceAnalysisBars.bind("barEnter",function(t){return function(e){return t.paceBarCallout.updateFromBarEvent(e)}}(this)).bind("barOut",function(t){return function(){return t.paceBarCallout.hide()}}(this)),this.graphs()[i]=this.paceBarCallout,this},i.prototype.buildCrossBar=function(t,e){return null==e&&(e=function(){}),this.crossBar=new this._crossBarClass(t),this.crossBar.builder(this).create(),e(this.crossBar),this.grid().bind("mousemove",function(t){return function(e,i){return t.crossBar.update(e,i)}}(this)).bind("gridclick",function(t){return function(){return t.crossBar.toggleFixedState()}}(this)).bind("gridout",function(t){return function(){return t.crossBar.hide()}}(this)),this.axis().selectedClass("selected").bind("axisClick",function(t){return function(e){return t.crossBar.forceFixedState(e)}}(this)),this},i.prototype.buildSplitCrossBar=function(t,e,i){var r;return null==i&&(i=function(){}),r=new this._crossBarClass(e).crossBarStyle("split-crossbar").groupName(t),r.builder(this).create(),i(r),this.splitCrossBars()[t]=r,this},i.prototype.buildInfoBox=function(t,e){return null==e&&(e=function(){}),this.infoBox=new this._infoBoxClass(t),this.infoBox.builder(this),e(this.infoBox),this.infoBox.create(),this.grid().bind("mousemove",function(t){return function(e,i){return t.infoBox.update(e,i)}}(this)).bind("gridclick",function(t){return function(){return t.infoBox.toggleFixedState()}}(this)).bind("gridout",function(t){return function(){return t.infoBox.hide()}}(this)),this.axis().selectedClass("selected").bind("axisClick",function(t){return function(e){return t.infoBox.forceFixedState(e)}}(this)),this},i.prototype.buildPointInfoBox=function(t,e,i){return null==i&&(i=function(){}),this.pointInfoBox=new this._pointInfoBoxClass(t,e),this.pointInfoBox.builder(this),i(this.pointInfoBox),this.pointInfoBox.create(),this.grid().bind("mousemove",function(t){return function(e,i){return t.pointInfoBox.move(e,i)}}(this)).bind("gridout",function(t){return function(){return t.pointInfoBox.hide()}}(this)),this},i.prototype.buildScrollBar=function(t,e){return null==e&&(e=function(){}),this.scrollBar=new this._scrollBarClass(this.context,this),e(this.scrollBar),this.scrollBar.create(),this.controls()[t]=this.scrollBar,this},i.prototype.buildBarChart=function(t,e,i,r,n,a){var s;return null==a&&(a=function(){}),s=(new this._barClass).width(r),s.builder(this).xScale(e).yScale(i).data(t).id(n).bind("barOut",function(t){return function(e){return t.grid().checkGridOut(e)}}(this)),this.grid().bind("gridout",function(){return function(){return s.unHighlightSplits()}}(this)),a(s),s.create(),this.graphs()[n]=s,this},i.prototype.buildBarChartAxis=function(t,e,i,r,n){return null==n&&(n=function(){}),this.axis(new this._axisClass(this)),n(this.axis()),this.axis().createForBarChart(t,e,i,r),this},i.prototype.buildBarChartKey=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=(new this._barChartKeyClass).xTranslation(r).keyWidth(e).builder(this).data(t).xScale(n).yScale(i).id(a),s(o),o.create(),this.graphs()[a]=o,this},i.prototype.buildIntegratedAxis=function(t,e,i,r,n,a){return null==n&&(n={}),null==a&&(a=function(){}),this.axis(new this._axisClass(this)),a(this.axis()),this.axis().createForIntegratedChart(t,e,i,r,n),this},i.prototype.buildDraggableRect=function(t,e){return this.dragRect=new this._draggableRectClass,this.dragRect.builder(this).xScale(e).data(t).create(),this},i.prototype.buildBrush=function(t){return this.brush=new this._brushClass,this.brush.builder(this).xScale(t).create()},i.prototype.buildAreaLine=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new this._areaClass,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.create(),this.graphs()[r]=a,this},i.prototype.buildStyledAreaLine=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=new this._areaClass,o.builder(this).xScale(e).yScale(i).data(t).style(n).groupId(a),s(o),o.create(),this.graphs()[r]=o,this},i.prototype.updateStyledAreaLine=function(t,e,i){var r;return null==i&&(i=function(){}),r=this.graphs()[t],r.data(e),r.update(!1),this},i.prototype.buildPlotGraph=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new this._plotGraphClass,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.create(),this.graphs()[r]=a,this},i.prototype.buildMarkers=function(t,e,i,r,n){var a;return null==n&&(n=function(){}),a=new Strava.D3.Charts.Marker,a.builder(this).xScale(e).yScale(i).data(t),n(a),a.render(),this.graphs()[r]=a,this},i.prototype.buildPartialAreaLine=function(t,e,i,r,n,a,s){var o;return null==s&&(s=function(){}),o=new this._partialAreaClass,o.builder(this).xScale(e).yScale(i).data(t).startIndex(n).endIndex(a),s(o),o.create(),this.graphs()[r]=o,this},i.prototype.buildFilter=function(t,e,i,r){var n;return n=new this._filterClass(this,i),n[e](t,r),this},i.prototype.zoomWithPadding=function(t,e){var i,r,n,a,s;a=this.xAxisExtent(t,e),s=this.yAxisExtent(t,e),this.zoomAxis(a,s),n=this._graphs;for(r in n)i=n[r],"altitude"===r||"segment"===r?i.zoom(a,s):i.zoom(a);return this},i.prototype.xAxisExtent=function(t,e){var i,r;return r=this.context.getStream("distance"),i=.1*(r[e]-r[t]),[Math.max(r[0],r[t]-i),Math.min(r[r.length-1],r[e]+i)]},i.prototype.yAxisExtent=function(t,e){var i,r,n,a;return(a=this.context.getStream("altitude"))?(i=d3.extent(a.slice(t,e+1)),r=.1*(i[1]-i[0]),n=this.yAxisSnap()*this.context.getMeasurementUnits().shortConvert,[Math.floor((i[0]-r)/n)*n,Math.ceil((i[1]+r)/n)*n]):[0,1]},i.prototype.resetZoom=function(){var t,e,i,r;this.resetAxis(),i=this._graphs,r=[];for(e in i)t=i[e],r.push(t.resetZoom());return r},i.prototype.zoomAxis=function(t,e){return this.axis().zoom(t,e),this.grid().update()},i.prototype.resetAxis=function(){return this.axis().resetZoom(),this.grid().update()},i.prototype.updateAxis=function(){return this.axis().update(),this.grid().update(),this},i.prototype.updateRoot=function(){return this.root.attr({width:this.width()+(this.padding().right+this.padding().left),height:this.height()+this.topGroupDimensions().height+(this.padding().top+this.padding().bottom)}),this},i.prototype.iterateGraphs=function(t){var e,i,r,n;i=this.graphs(),r=[];for(n in i)e=i[n],r.push(t(n,e));return r},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes.ElevationChartView"),Strava.Routes.ElevationChartView=function(e){function i(t,e){this.context=t,this.height=null!=e?e:125,i.__super__.constructor.call(this),this.builder=new Strava.D3.Charts.Builder(this.context),this.$container=this.$$("#chart-container"),this.context.bind("ready",function(t){return function(){return t.createElevationChart()}}(this)).bind("updateSize",function(t){return function(){return t.updateSize()}}(this)).bind("updateElevation",function(t){return function(){return t.updateElevation()}}(this)).bind("createDefaults",function(t){return function(){return t.createDefaults()}}(this))}return t(i,e),i.prototype.chartWidth=function(){return this.$container.width()-this.builder.padding().left-this.builder.padding().right},i.prototype.xAxisTicks=function(){return this.chartWidth()>500?10:6},i.prototype.updateSize=function(){return this.updateChartValues()},i.prototype.updateChartValues=function(){return this.builder.width(this.chartWidth()),this.$$("svg").attr("width",this.$container.width()),this.xScale.range([0,this.builder.width()]),this.builder.axis().setScale("x",this.xScale).setScale("y",this.yScale).updateCanvas(),this.builder.grid().updateCanvas(),this.context.getModifiedElevationStream().length?this.showData():this.removeData()},i.prototype.updateElevation=function(){var t;return t=this.context.getModifiedElevationStream(),t.length&&(this.xDomain=d3.extent(t,function(t){return t.x}),this.yDomain=d3.extent(t,function(t){return t.y}),this.xScale.domain(this.xDomain),this.yScale.domain(this.yDomain),null==this.builder.graphs().altitude&&this.createAltitudeGraph(),this.builder.graphs().altitude.data(this.context.getModifiedElevationStream())),this.updateChartValues()},i.prototype.createDefaults=function(){return this.builder.width(this.chartWidth()).height(this.height).xAxisTicks(this.xAxisTicks()).animate(!1).build(this.$container).buildGrid().buildAxis(),this.xScale=d3.scale.linear().domain([0,10]).range([0,this.builder.width()]),this.yScale=d3.scale.linear().domain([0,1e3]).range([this.builder.height(),0]),this.builder.axis().setScaleDomain("x",[0,10]).setScaleDomain("y",[0,1e3]).setAxisTicks("y",this.builder.yAxisTicks()).setAxisTicks("x",this.builder.xAxisTicks()).setScaleNice("y")},i.prototype.createElevationChart=function(){return this.builder.width(this.chartWidth()).height(this.height).xAxisTicks(this.xAxisTicks()).build(this.$container).buildGrid().buildAxis(),this.createScales(),this.createAltitudeGraph(),this.createSegmentGraph(0,0),this.builder.axis().setScaleDomain("x",this.xDomain).setScaleDomain("y",this.yDomain).setAxisTicks("y",this.builder.yAxisTicks()).setAxisTicks("x",this.builder.xAxisTicks()).setScaleNice("y"),this.builder.updateAxis()},i.prototype.createScales=function(){var t;return t=this.context.getModifiedElevationStream(),this.xDomain=d3.extent(t,function(t){return t.x}),this.yDomain=d3.extent(t,function(t){return t.y}),this.xScale=d3.scale.linear().domain(this.xDomain).range([0,this.builder.width()]),this.yScale=d3.scale.linear().domain(this.yDomain).range([this.builder.height(),0]).nice()},i.prototype.createAltitudeGraph=function(){var t;return t=new Strava.I18n.PercentFormatter,this.builder.buildAreaLine(this.context.getModifiedElevationStream(),this.xScale,this.yScale,"altitude"),this.builder.buildCrossBar(function(t){return function(e){var i;return i=new Strava.I18n.ChartLabelDistanceFormatter(t.context.getUnitSystem()),i.formatShort(t.xScale.invert(e))}}(this),function(){return function(t){return t.allowFixedState(!1)}}(this)),this.builder.buildInfoBox(function(e){return function(i){var r,n,a,s,o;return a=new Strava.I18n.ChartLabelElevationFormatter(e.context.getUnitSystem()),r={},o=e.getDistanceIndex(i),n=e.context.getModifiedElevationStream()[o].y,s=e.context.getGradeStream()[o],r.Elev={title:Strava.I18n.Locale.t("templates.routes.elevation_chart_view.elev"),val:a.formatShort(n),label:""},r.Grade={title:Strava.I18n.Locale.t("templates.routes.elevation_chart_view.grade"),val:t.formatShort(s),label:""},r}}(this),function(){return function(t){return t.allowFixedState(!1)}}(this)),this.setEventDispatcher()},i.prototype.createSegmentGraph=function(t,e){return this.builder.buildPartialAreaLine(this.context.getModifiedElevationStream(),this.xScale,this.yScale,"segment",t,e)},i.prototype.removeData=function(){return null!=this.builder.graphs().altitude&&this.builder.graphs().altitude.hide(),null!=this.builder.crossBar&&(this.builder.crossBar.hide(),this.builder.crossBar.disable()),null!=this.builder.infoBox?(this.builder.infoBox.hide(),this.builder.infoBox.disable()):void 0},i.prototype.showData=function(){return this.builder.graphs().altitude.updateCanvas(),this.builder.graphs().altitude.show(),this.builder.crossBar.enable(),this.builder.crossBar.updateCanvas(),this.builder.infoBox.enable(),this.builder.infoBox.updateCanvas()},i.prototype.setEventDispatcher=function(){return this.builder.grid().bind("mousemove",function(t){return function(e,i){return t.handleGridMouseMove(e,i)}}(this)).bind("gridout",function(t){return function(e,i){return t.handleGridOut(e,i)}}(this)),this.context.eventDispatcher().addListener(this,this)},i.prototype.getDistanceIndex=function(t){var e;return e=this.xScale.invert(t),d3.bisectLeft(this.context.getDistanceStream(),e)},i.prototype.handleGridMouseMove=function(t){var e,i;if(this.context.getModifiedElevationStream().length)return e=this.xScale.invert(t),i=new Strava.I18n.DistanceFormatter(this.context.getUnitSystem()),this.context.eventDispatcher().dispatchEstimateMouseOver(this,"distance",this.context.getLatLngFromDist(e/i.convert(1)))},i.prototype.handleGridOut=function(){return this.context.eventDispatcher().dispatchMouseOut(this,"distance")},i.prototype.handleStreamHover=function(t,e,i){return"distance"===t?this.builder.graphs().segment.startIndex(e).endIndex(i).update():void 0},i.prototype.handleStreamHoverOut=function(){return this.builder.graphs().segment.hide()},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.ExportLightboxView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.lightbox=new Strava.Ui.LightboxView("export-route"),this.exportView=new Strava.Routes.ExportView(t),this.model.on("finished",this.close,this)
},i.prototype.render=function(){return this.lightbox.renderWithRenderer(this.exportView),this},i.prototype.close=function(){return this.lightbox.closeBox()},i.show=function(t){return null==this.instance&&(this.instance=new Strava.Routes.ExportLightboxView(t)),this.instance.render()},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.ExportView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.className="edit-route",i.prototype.events={"click #device a":"changeDevice"},i.prototype.initialize=function(){return this.create_template("#export-route-template"),this.model.on("exported",this.showExportResult,this)},i.prototype.render=function(){return this.render_template(),this.delegateEvents(),this},i.prototype.changeDevice=function(t){var e,i,r,n,a,s;return a=this.$(t.target),s=a.closest("li").data("value"),r=a.closest(".drop-down-menu"),n=r.find(".selection"),n.data("current",s),n.text(a.text()),e=r.parent(),e.find(".device-photo").addClass("hidden"),e.find("#"+s+"-photo").removeClass("hidden"),i=this.$(".device-content"),i.find(" > div").addClass("hidden"),i.find("#"+s+"-content").removeClass("hidden")},i}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["routes/overview"]=function(t){return function(){var t,e,i,r,n,a,s;if(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='main section spans11'>\n  <div class='map' id='map-canvas'>\n    <div class='spinner streams-loader vcentered'>\n      <div class='graphic'></div>\n    </div>\n  </div>\n  <div class='grabber'></div>\n  <div id='chart-container'>\n    <div class='base-chart'></div>\n  </div>"),this.routeSegments.length>0){for(i.push("  <div class='bottomless popular-segments section'>\n    <h2 class='header'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.segments")))+"</h2>\n    <table class='dense marginless segments striped'>\n      <thead>\n        <tr>\n          <th>"+e(t(Strava.I18n.Locale.t("templates.generic.name")))+"</th>\n          <th>"+e(t(Strava.I18n.Locale.t("templates.generic.distance")))+"</th>\n          <th>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.elevation_difference")))+"</th>\n          <th>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.average_grade")))+"</th>\n        </tr>\n      </thead>\n      <tbody>"),a=this.routeSegments,r=0,n=a.length;n>r;r++)s=a[r],(s.newly_created_segment||s.ratio&&s.ratio>this.minSegmentFilterRatio)&&i.push("        <tr data-start-distance='"+e(t(s.start_distance))+"' data-end-distance='"+e(t(s.end_distance))+"'>\n          <td>\n            <a href='/segments/"+e(t(s.id))+"'>"+e(t(s.name))+"</a>\n          </td>\n          <td>"+e(t(this.distFormatter.formatShort(s.distance)))+"</td>\n          <td>"+e(t(this.elevFormatter.formatShort(s.elev_difference)))+"</td>\n          <td>"+e(t(this.percentFormatter.formatShort(s.avg_grade)))+"</td>\n        </tr>");i.push("      </tbody>\n    </table>\n  </div>")}return i.push("</div>\n<div class='offset1 sidebar spans4'>\n  <div class='route-details'>\n    <a class='avatar avatar-athlete avatar-lg' href='/athletes/"+e(t(this.athlete.id))+"'>\n      <img src='"+e(t(this.athlete.photo))+"'>\n    </a>\n    <div class='details'>"),this.athlete.premium&&(i.push("      <div class='athlete-title'>"),i.push("        "+t(this.athlete.badge)),i.push("        "+e(t(Strava.I18n.Locale.t("templates.routes.overview.premium")))),i.push("      </div>")),i.push("      <h3 class='bottomless'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.created_by",{name:this.athlete.display_name})))+"</h3>\n      <div class='timestamp'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.created_on",{date:this.route.createdAtDisplay})))+"</div>\n    </div>\n  </div>\n  <hr>\n  <ul class='inline-stats narrow'>\n    <li>\n      <strong>"),i.push("        "+e(t(this.route.lengthDisplay))),i.push("        \x91<abbr class='unit' title='"+e(t(this.distFormatter.unitLong()))+"'>"+e(t(this.distFormatter.unitShort()))+"</abbr>\x92\n      </strong>\n      <div class='label static-label'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.distance")))+"</div>\n    </li>\n    <li>\n      <strong>"),i.push("        "+e(t(this.route.elevationGainDisplay))),i.push("        \x91<abbr class='unit' title='"+e(t(this.elevFormatter.unitLong()))+"'>"+e(t(this.elevFormatter.unitShort()))+"</abbr>\x92\n      </strong>\n      <div class='label static-label'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.elevation_gain")))+"</div>\n    </li>\n    <li>\n      <strong class='sub-type'>"+e(t(this.route.displaySubType))+"</strong>\n      <div class='label static-label'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview."+this.route.typeKey+"_type")))+"</div>\n    </li>\n  </ul>"),this.movingTime&&(i.push("  <div class='moving-time' title='"+e(t(this.movingTimeExplanation))+"'>\n    <span class='label static-label'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.estimated_moving_time")))+"</span>"),i.push("    "+e(t(this.movingTime))),i.push("  </div>")),this.route.unescapedDescription&&i.push("  <hr>\n  <div class='route-description'>"+t(this.route.description)+"</div>"),!this.route.is_private&&currentAthlete.get("logged_in")&&i.push("  <div id='share-module'>\n    <hr>\n    <h3>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.share_title")))+"</h3>\n    <div class='share-module'>\n      <button class='btn-primary button' id='share' data-tab='invite'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.share_button")))+"</button>\n      <div class='app-icon clickable fb-share icon-dark icon-fb icon-sm' title='Share on Facebook' data-tab='facebook'>Facebook</div>\n      <div class='app-icon clickable icon-dark icon-sm icon-twitter twitter-share' title='Twitter' data-tab='twitter'>Twitter</div>\n      <div class='app-icon clickable email-share icon-dark icon-email icon-sm' title='Share by Email' data-tab='email'>"+e(t(Strava.I18n.Locale.t("templates.routes.overview.share_title")))+"</div>\n    </div>\n  </div>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.OverviewView=function(e){function i(t,e,r){i.__super__.constructor.call(this),this.pageContext=t,this.dataContext=e,this.eventDispatcher=r,this.template="routes/overview"}return t(i,e),i.prototype.tagName="div",i.prototype.className="row",i.prototype.events={"mouseenter table.segments tbody tr":"handleSegmentMouseOver","mouseleave table.segments tbody tr":"handleSegmentMouseOut"},i.prototype.render=function(){var t,e,i,r;return r=this.pageContext.speed(),null!=r&&r>0&&(e=Strava.Routes.Route.movingTime(this.pageContext.route().get("length"),r),i=Strava.Routes.Route.movingTimeExplanation(r,this.pageContext.route().get("route_type"))),t={athlete:this.pageContext.routeAthlete().toJSON(),minSegmentFilterRatio:this.pageContext.minSegmentFilterRatio(),route:this.pageContext.route().present(),routeSegments:this.pageContext.routeSegments(),distFormatter:new Strava.I18n.DistanceFormatter,elevFormatter:new Strava.I18n.ElevationFormatter,percentFormatter:new Strava.I18n.PercentFormatter,movingTime:e,movingTimeExplanation:i},this.renderTemplate(t),this},i.prototype.handleSegmentMouseOver=function(t){var e,i,r,n,a;return e=this.$$(t.target).closest("tr"),n=e.data("start-distance"),i=e.data("end-distance"),a=d3.bisectLeft(this.dataContext.distanceStream(),n*strava.i18n.measurementUnits().longConvert),r=d3.bisectLeft(this.dataContext.distanceStream(),i*strava.i18n.measurementUnits().longConvert),this.eventDispatcher.dispatchHover(this,"distance",a,r),a=d3.bisectLeft(this.dataContext.getLatLngDistanceStream(),n),r=d3.bisectLeft(this.dataContext.getLatLngDistanceStream(),i),this.eventDispatcher.dispatchHover(this,"latlng",a,r),this},i.prototype.handleSegmentMouseOut=function(){return this.eventDispatcher.dispatchHoverOut(this,"latlng"),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.ViewFactory=function(e){function i(){i.__super__.constructor.call(this),this.initializeAttributes(r),this.mapFactory(Strava.Maps.mapFactory)}var r;return t(i,e),r={page:null,mapFactory:null,overviewFactory:Strava.Routes.OverviewView,cueSheetFactory:Strava.Routes.CueSheetView,elevationChartFactory:Strava.Routes.ElevationChartView},i.prototype.createOverviewView=function(){var t,e;return t=this.$$("#view"),e=new this._overviewFactory(this.page().pageContext(),this.page().routeDataContext(),this.page().eventDispatcher()),e.render(),t.html(e.el),this.createMap(t,"#map-canvas",250),this.createElevationChart()},i.prototype.createMap=function(t,e,i){var r,n,a;return r=t.find(e),n=new this._mapFactory(this.page().mapContext(),r).showFullScreenToggle(!1).showGpxDownload(!1),this.page().mapContext().ready(),a=new Strava.Ui.Resizer(t.find(".grabber"),e),a.onComplete(function(){return function(){return n.getMap().resize()}}(this)).min(i).size(r.height())},i.prototype.createElevationChart=function(t){return new this._elevationChartFactory(this.page().chartContext(),t),this.page().chartContext().ready()},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Maps.LatLngStream=function(e){function i(t){i.__super__.constructor.call(this),this.latlngs=t}return t(i,e),i.prototype.first=function(){var t;return t=this.latlngs[0],t?{lat:t[0],lng:t[1]}:null},i.prototype.end=function(){var t;return this.latlngs.length>0?(t=this.latlngs[this.latlngs.length-1],t?{lat:t[0],lng:t[1]}:null):null},i.prototype.each=function(t){var e,i,r,n,a,s;for(a=this.latlngs,s=[],i=e=0,r=a.length;r>e;i=++e)n=a[i],null!=n&&s.push(t(i,n[0],n[1]));return s},i.prototype.ready=function(){return this.latlngs&&this.latlngs.length>0},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.RouteGenerator=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.route=function(t,e,i){var r;return r={elements:t,preferences:e},Strava.Routes.RouteGenerator.postJson("/routemaster/route",r,function(t){return function(e){var r;return r=t.unpackRoute(e),i(r)}}(this))},i.prototype.routeForActivity=function(t,e){var i;return i={activity_id:t},Strava.Routes.RouteGenerator.postJson("/routemaster/route_for_activity",i,function(t){return function(i){var r;return r=t.unpackRoute(i),e(r)}}(this))},i.prototype.unpackRoute=function(t){var e,i,r,n,a,s,o,l,u,h,c,p,d,f;p=t.legs;for(s in p){a=p[s],d=a.paths;for(u in d){for(l=d[u],l.decodedElevation=Strava.Routes.RouteGenerator.decodeElevation(l.elevation),l.decodedPolyline=Strava.Routes.RouteGenerator.decodePath(l.polyline),i=[],e=0,n=l.decodedPolyline[0],f=l.decodedPolyline,c=r=0,o=f.length;o>r;c=++r)h=f[c],e+=Strava.Routes.RouteGenerator.distance(n,h),n=h,i.push([e,c]);l.length=e,l.distanceIndex=i}}return t},i.distance=function(t,e){var i,r,n,a,s,o,l,u;return a=6371e3,o=3.14159/180,r=(e[0]-t[0])*o,n=(e[1]-t[1])*o,s=(t[0]+e[0])/2*o,l=Math.cos(s)*n,i=r*r+l*l,u=a*Math.sqrt(i)},i.decodeElevation=function(t){var e;return e=[],Strava.Routes.RouteGenerator._decodeElevation(t.data,function(t,i){return e.push([t,i])}),e},i.decodeElevationWithXY=function(t,e){var i;return i=[],Strava.Routes.RouteGenerator._decodeElevation(t.data,function(t,r){return i.push({x:e+t,y:r})}),i},i._decodeElevation=function(t,e){var i,r,n,a,s,o,l,u,h,c,p,d;for(n=1e-4,i=.001,r=90,s=polyline.decode(t),a=0,d=[],l=u=0,h=s.length;h>u;l=++u)p=s[l],c=p[0]/n,o=p[1]/i,l>0&&s[l-1][0]>s[l][0]+.1&&(a+=1),d.push(e(c+a*r/n,o));return d},i.decodePath=function(t){return polyline.decode(t.data)},i.postJson=function(t,e,i){return jQuery.ajax({url:t,type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",complete:function(t){return"{"===t.responseText[0]?i(JSON.parse(t.responseText)):"error"}})},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.I18n"),Strava.I18n.Locale=function(){function t(){}return t.COUNT_PARAMETER="count",t.DECIMAL_FORMATTER=new TwitterCldr.DecimalFormatter,t.t=function(t,e,i,r){var n,a,s,o,l,u,h,c,p,d;null==e&&(e={}),null==i&&(i=Strava.I18n.Locales.DICTIONARY),null==r&&(r=Strava.I18n.Locales.PLURALIZATION),d=i,l=t.split("."),Strava.I18n.Locale.COUNT_PARAMETER in e&&(p=r(e[Strava.I18n.Locale.COUNT_PARAMETER]));for(a=0,u=l.length;u>a;a++)if(o=l[a],d=d[o],null==d)return t;if(null!=p){for(n=!1,s=0,h=p.length;h>s;s++)if(c=p[s],null!=d[c]){d=d[c],n=!0;break}if(!n)return t}return this.resolve(d,e)},t.resolve=function(t,e){return t.replace(/%%|%{(\w+)}/g,function(t,i){if("%%"===t)return"%";if(i in e)return i===Strava.I18n.Locale.COUNT_PARAMETER?Strava.I18n.Locale.DECIMAL_FORMATTER.format(e[i]):e[i];throw new Error("param "+i+" not provided")})},t.measurementPreference=function(){return window._measurement_preference},t.unitSystem=function(){return"feet"===this.measurementPreference()?"imperial":"metric"},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Routes.RouteDataContext=function(e){function i(t,e){this.scaleFactor=null!=e?e:null,i.__super__.constructor.call(this),this.initializeAttributes(r),this.setStreamData(t)}var r;return t(i,e),r={routeGenerator:Strava.Routes.RouteGenerator,latlngStream:new Strava.Maps.LatLngStream([]),elevationStream:[],elevationGain:0,distanceStream:[],modifiedStream:null,gradeStream:null,eventDispatcher:null,latLngDistStream:null,unitSystem:Strava.I18n.Locale.unitSystem()},i.prototype.setStreamData=function(t){var e,i,r,n,a,s,o,l,u,h,c,p,d;if(this.modifiedStream(null),this.gradeStream(null),this.latLngDistStream(null),o=[],n=[],e=0,r=0,null!=t.data)o=this.routeGenerator().decodePath(t);else for(a=0,u=t.length;u>a;a++)for(l=t[a],p=l.paths,s=0,h=p.length;h>s;s++)c=p[s],o=o.concat(this.routeGenerator().decodePath(c.polyline)),i=this.routeGenerator().decodeElevationWithXY(c.elevation,e),r+=c.elevation_gain,i.length?(n=n.concat(i),e=_.last(n).x):(e+=c.length,c===_.last(l.paths)&&n.push({x:e,y:_.last(n).y}));return null!=this.scaleFactor&&(d=this.scaleFactor,n=n.map(function(t){return{y:t.y,x:t.x*d}})),this.elevationGain(r),this.elevationStream(n),this.createDistanceStream(),this.latlngStream(new Strava.Maps.LatLngStream(o))},i.prototype.createDistanceStream=function(){var t,e,i,r,n;for(t=[],n=this.getModifiedElevationStream(),e=0,i=n.length;i>e;e++)r=n[e],t.push(r.x);return this.distanceStream(t)},i.prototype.getModifiedElevationStream=function(){var t,e,i,r,n,a,s;if(null!=this.modifiedStream())return this.modifiedStream();for(a=[],t=new Strava.I18n.DistanceFormatter(this.unitSystem()),e=new Strava.I18n.ElevationFormatter(this.unitSystem()),s=this.elevationStream(),i=0,r=s.length;r>i;i++)n=s[i],a.push({x:t.convert(n.x),y:e.convert(n.y)});return this.modifiedStream(a),this.modifiedStream()},i.prototype.getGradeStream=function(){var t,e,i,r,n,a,s,o,l,u,h,c;if(null!=this.gradeStream())return this.gradeStream();for(i=this.elevationStream(),n=[],u=1,a=s=0,o=i.length;o>s;a=++s)h=i[a],r=0,l=Math.max(a-u,0),c=Math.min(a+u,i.length-1),t=i[c].x-i[l].x,e=i[c].y-i[l].y,r=e/t*100,n.push(r);return this.gradeStream(n)},i.prototype.getLatLngDistanceStream=function(){var t,e,i,r,n,a,s,o;if(null!=this.latLngDistStream())return this.latLngDistStream();for(s=[],t=0,r=this.latlngStream().latlngs,i=r[0],o=null!=this.scaleFactor?this.scaleFactor:1,e=0,n=r.length;n>e;e++)a=r[e],t+=this.routeGenerator().distance(i,a),i=a,s.push(t*o);return this.latLngDistStream(s),this.latLngDistStream()},i.prototype.crossInterpolateStreams=function(t,e){var i,r,n,a,s,o,l,u,h,c,p,d,f,v,g,y,x,m;for(a=1,f=[],n=[],d=0,h=t[0],x=0,y=e[0][0],r=e[0][1],u=0,c=t.length;c>u;u++){for(p=t[u],d+=this.routeGenerator().distance(p,h);d-a>=y&&(i=this.routeGenerator().distance(p,h),m=i>a?Math.max((y-(d-i))/i,0):1,o=h[0]*(1-m)+p[0]*m,l=h[1]*(1-m)+p[1]*m,f.push([o,l]),n.push([y,r]),x+=1,!(x>=e.length));)y=e[x][0],r=e[x][1];y>d+a?(v=e[x-1][0],g=e[x-1][1],i=y-v,m=i>a?Math.max((d-v)/i,0):1,s=g*(1-m)+r*m,n.push([d,s])):n.push([d,r]),f.push(p),h=p}return[f,n]},i.prototype.getLatLngFromDist=function(t){var e,i,r,n,a,s,o,l;return s=this.getLatLngDistanceStream(),a=this.latlngStream().latlngs,l=d3.bisectLeft(s,t),r=Math.max(l-1,0),l>=a.length&&(l=r),i=s[r],o=s[l],n=a[r],e=_.clone(a[l]),o>i&&(e[0]-=(o-t)/(o-i)*(e[0]-n[0]),e[1]-=(o-t)/(o-i)*(e[1]-n[1])),e},i.prototype.routeDetails=function(){var t,e,i,r,n,a,s,o,l;return e=this.elevationStream(),i=e[0],r=e[e.length-1],t=r.y-i.y,o=r.x-i.x,l=this.elevationGain(),s=d3.extent(e,function(t){return t.y}),a=s[0],n=s[1],{highestElevation:n,lowestElevation:a,elevationDifference:t,elevationGain:l,totalDistance:o}},i}(Strava.Base)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Maps"),Strava.Routes.RouteChartContext=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.dataContext(t),this.eventDispatcher(e)}var r;return t(i,e),r={eventDispatcher:null,dataContext:null},i.prototype.ready=function(){return this.trigger("ready")},i.prototype.setStreamData=function(t){return this.dataContext().setStreamData(t)},i.prototype.xTickFormat=function(){return function(t){return function(e){var i;return i=new Strava.I18n.ChartLabelDistanceFormatter(t.getUnitSystem()),i.formatShort(e)}}(this)},i.prototype.yTickFormat=function(){return function(t){return function(e){var i;return i=new Strava.I18n.ChartLabelElevationFormatter(t.getUnitSystem()),i.formatShort(e)}}(this)},i.prototype.getModifiedElevationStream=function(){return this.dataContext().getModifiedElevationStream()},i.prototype.getGradeStream=function(){return this.dataContext().getGradeStream()},i.prototype.getLatLngFromDist=function(t){return this.dataContext().getLatLngFromDist(t)},i.prototype.getDistanceStream=function(){return this.dataContext().distanceStream()},i.prototype.getUnitSystem=function(){return this.dataContext().unitSystem()},i}(Strava.Base)}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.StringUtils=function(){function t(){}return t.prototype.strip=function(t){return t?t.replace(/^\s+|\s+$/g,""):t},t.pad=function(t,e){var i;for(i=t+"";i.length<e;)i="0"+i;return i},t.lpad=function(t,e,i){var r;for(null==i&&(i="&nbsp;"),"string"==typeof e&&(e=e.length),t+="",r=t.length;e>r;)t=i+t,r++;return t},t.prototype.shorten=function(t,e,i){var r;return null==i&&(i="..."),t&&""!==t?(t=this.strip(t),t.length>e?r=t.substring(0,e-i.length)+i:t):t},t.simpleFormat=function(t){var e,i,r,n,a;return n="<p>",r="</p>",e="<br />",i="\n",a=""+n+t+r,a=a.replace(/\r\n?/g,i),a=a.replace(/(\n{2,})/g,r+"$1"+n),a=a.replace(/([^\n]\n)(?=[^\n])/g,"$1"+e)},t.toCamel=function(t){return t.replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},t}()}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.Route=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.RIDE=1,i.RUN=2,i.TYPE_KEY={1:"ride",2:"run"},i.SPORT_TYPE={1:"cycling",2:"running"},i.ROAD=1,i.MTB=2,i.CX=3,i.TRAIL=4,i.MIXED=5,i.DISPLAY_SUBTYPE={1:Strava.I18n.Locale.t("templates.routes.route.display_subtypes.road"),2:Strava.I18n.Locale.t("templates.routes.route.display_subtypes.mtb"),3:Strava.I18n.Locale.t("templates.routes.route.display_subtypes.cyclocross"),4:Strava.I18n.Locale.t("templates.routes.route.display_subtypes.trail"),5:Strava.I18n.Locale.t("templates.routes.route.display_subtypes.mixed_terrain")},i.SUBTYPES_BY_TYPE={1:[i.ROAD,i.MTB,i.CX],2:[i.ROAD,i.TRAIL]},i.DIRECTION_ACTIONS={1:"left",2:"right",3:"continue",4:"proceed"},i.prototype.defaults={popularity:1,elevation:0,manual:0},i.prototype.initialize=function(t){return this.state=null==t||_.isEmpty(t)?"new":"loaded"},i.prototype.setRoutestore=function(t){return this.routestore=t},i.prototype.getPreferences=function(){return{popularity:this.get("popularity"),elevation:this.get("elevation"),route_type:this.get("route_type")}},i.prototype.load=function(t,e){return null==t&&(t={}),null==e&&(e=!1),this.set(t),this.state="loaded",(e||!t.route_id)&&(this.state="new",this.set("athlete_id",currentAthlete.get("id"))),this.trigger(this.state)},i.prototype.update=function(){return"new"===this.state?(this.state="creating",this.trigger(this.state),this.routestore.create(this.attributes,function(t){return function(e){return null==e.error?(t.set("route_id",e.route_id),t.state="loaded",t.trigger("created")):(t.state="error",t.trigger(t.state))}}(this))):"loaded"===this.state?(this.state="updating",this.trigger(this.state),this.routestore.update(this.attributes,function(t){return function(e){return null==e.error?(t.state="loaded",t.trigger("updated")):(t.state="error",t.trigger(t.state))}}(this))):void 0},i.prototype.cancel=function(){return this.trigger("cancelled")},i.prototype.present=function(){var t,e,r;return t=this.toJSON(),r=Strava.I18n.Locale.unitSystem(),t.lengthDisplay=new Strava.I18n.DistanceFormatter(r).format(t.length),t.elevationGainDisplay=new Strava.I18n.ElevationFormatter(r).format(t.elevation_gain),t.createdAtDisplay=(new Strava.I18n.DateTimeFormatter).format(new Date(t.created_at),{format:"date",type:"long"}),t.typeKey=i.TYPE_KEY[t.route_type],t.displaySubType=i.DISPLAY_SUBTYPE[t.sub_type],t.unescapedDescription=t.description,e=_.template("{{text}}",{text:t.description||""}),t.description=Strava.Util.StringUtils.simpleFormat(e),t},i.getSubtypeOptions=function(t){var e,r,n,a,s;for(n=[],a=i.SUBTYPES_BY_TYPE[t],e=0,r=a.length;r>e;e++)s=a[e],n.push([s,i.DISPLAY_SUBTYPE[s]]);return n},i.distanceDisplay=function(t,e){return null==e&&(e=Strava.I18n.Locale.unitSystem()),new Strava.I18n.DistanceFormatter(e).format(t)},i.directionAction=function(t){return null==t||null==i.DIRECTION_ACTIONS[t]?i.DIRECTION_ACTIONS[4]:i.DIRECTION_ACTIONS[t]},i.directionString=function(t,e){return"Unknown"===e?Strava.I18n.Locale.t("templates.routes.route.directions.off_road"):e&&"''"!==e?Strava.I18n.Locale.t("templates.routes.route.directions."+t+"_on",{road:e}):Strava.I18n.Locale.t("templates.routes.route.directions."+t)},i.movingTime=function(t,e){return(new Strava.I18n.TimespanFormatter).display(t/e)},i.movingTimeExplanation=function(t,e,r){var n,a;return null==r&&(r=!1),a=e===i.RIDE?(new Strava.I18n.DistancePerTimeFormatter).formatShort(3600*t):(new Strava.I18n.PaceFormatter).formatShort(t),n=r?"message_short":"message",n="strava.routes.route.estimated_moving_time.explanation."+n+"."+i.SPORT_TYPE[e],Strava.I18n.Locale.t(n,{value:a})},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.Routes=function(e){function i(t){i.__super__.constructor.call(this),this.athleteId=t}return t(i,e),i.prototype.model=Strava.Routes.Route,i.prototype.url=function(){return"/athletes/"+this.athleteId+"/routes"},i}(Backbone.Collection)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["routes/index"]=function(t){return function(){var t,e,i,r,n,a,s,o,l,u,h,c;if(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],this.hasRoutes&&(i.push("<form class='sport-select' action='/athlete/routes' method='get'>\n  <div class='inline-inputs'>\n    \x91<span>\n      <ul class='switches' id='route-type'>\n        <input name='type' type='hidden'>\n        <li>\n          <div class='button' data-value='"+e(t(Strava.Routes.Route.RIDE))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.cycling")))),i.push("          </div>\n        </li>\n        <li>\n          <div class='button' data-value='"+e(t(Strava.Routes.Route.RUN))+"'>"),i.push("            "+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.running")))),i.push("          </div>\n        </li>\n      </ul>\n    </span>\x92\n  </div>\n</form>")),this.routes.length>0){for(i.push("<ul class='routes-list'>"),c=Strava.I18n.Locale.unitSystem(),r=new Strava.I18n.DistanceFormatter(c),n=new Strava.I18n.ElevationFormatter(c),l=this.routes,s=0,o=l.length;o>s;s++)u=l[s],i.push("  <li class='route-card'>\n    <a href='/routes/"+e(t(u.id))+"'>\n      <div class='map' id='"+this.mapIdBase+u.id+"'></div>\n    </a>\n    <div class='metadata'>\n      <h3>\n        <a href='/routes/"+e(t(u.id))+"' title='"+e(t(u.metadata.name))+"'>"+e(t(u.display_name))+"</a>"),u.metadata.is_private&&i.push("        <div class='lock sprite' title='"+e(t(Strava.I18n.Locale.t("templates.generic.private")))+"'></div>"),i.push("      </h3>\n      <ul class='inline-stats'>\n        <li>\n          <strong>"),i.push("            "+e(t(u.length_display))),i.push("            \x91<abbr class='unit' title='"+e(t(r.unitLong()))+"'>"+e(t(r.unitShort()))+"</abbr>\x92\n          </strong>\n          <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.distance")))+"</div>\n        </li>\n        <li>\n          <strong>"),i.push("            "+e(t(u.elevation_gain_display))),i.push("            \x91<abbr class='unit' title='"+e(t(n.unitLong()))+"'>"+e(t(n.unitShort()))+"</abbr>\x92\n          </strong>\n          <div class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.elevation_gain")))+"</div>\n        </li>\n      </ul>"),null!=u.moving_time&&(i.push("      <div class='moving-time' title='"+e(t(this.movingTimeExplanation))+"'>\n        <span class='label'>"+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.estimated_moving_time")))+"</span>"),i.push("        "+e(t(u.moving_time))),i.push("      </div>")),i.push("    </div>\n    <div class='timestamp'>"),i.push("      "+e(t(u.timestamp_display))),i.push("    </div>\n    <div class='actions'>\n      <div class='starred "+(u.starred_on?"active":void 0)+"' data-route-id='"+e(t(u.id))+"'>\n        &#9733;\n      </div>"),u.created_by_user&&(i.push("      <div class='clear'></div>\n      <div class='side-slide-menu slide-menu subactions' data-route-id='"+e(t(u.id))+"'>\n        <div class='selection'>\n          <div class='sprite wrench'></div>\n        </div>\n        <ul class='options'>\n          <li>\n            <a class='delete-route nav secondary' href='javascript:;'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.delete_route")))),i.push("            </a>\n          </li>\n          <li>\n            <a class='nav secondary' href='/routes/"+e(t(u.id))+"/edit'>"),i.push("              "+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.edit_route")))),i.push("            </a>\n          </li>\n        </ul>\n      </div>")),i.push("    </div>\n  </li>");i.push("</ul>"),this.pagination&&this.pagination.totalResults>this.pagination.resultsPerPage&&(i.push("<div class='pagination simple'>\n  <span class='pages'>\n    <strong>"),h=(this.pagination.page-1)*this.pagination.resultsPerPage+1,a=h+this.routes.length-1,i.push("      "+e(t(h))),a>h&&i.push("      "+e(t("- "+a))),i.push("    </strong>"),i.push("    "+e(t("of "+this.pagination.totalResults))),i.push("  </span>\n  <ul class='switches'>\n    <li>"),i.push(this.pagination.page>1?"      <a class='button' href='"+e(t(this.filteredURI+"page="+(this.pagination.page-1)))+"'>&larr;</a>":"      <span class='button disabled'>&larr;</span>"),i.push("    </li>\n    <li>"),i.push(a<this.pagination.totalResults?"      <a class='button' href='"+e(t(this.filteredURI+"page="+(this.pagination.page+1)))+"'>&rarr;</a>":"      <span class='button disabled'>&rarr;</span>"),i.push("    </li>\n  </ul>\n</div>"))}else this.hasRoutes&&i.push(""+e(t(Strava.I18n.Locale.t("templates.routes.route_index_view.no_"+Strava.Routes.Route.SPORT_TYPE[this.routeType].toLowerCase()+"_routes"))));return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.RoutesIndexView=function(e){function i(t){i.__super__.constructor.call(this),this.pageContext=t,this.template="routes/index"}return t(i,e),i.prototype.tagName="section",i.prototype.id="routes",i.prototype.render=function(){var t,e,i,r,n,a,s,o,l,u,h,c,p,d,f,v,g,y,x,m;for(f=this.pageContext.routes().toJSON(),g=Strava.Util.I18n.stringFormatter(),d=this.pageContext.filters().type,v=this.pageContext.speed(),x=Strava.I18n.Locale.unitSystem(),n=new Strava.I18n.DistanceFormatter(x),a=new Strava.I18n.ElevationFormatter(x),r=new Strava.I18n.DateTimeFormatter,null!=v&&v>0&&(h=Strava.Routes.Route.movingTimeExplanation(v,d)),l=0,u=f.length;u>l;l++)p=f[l],p.display_name=g.start(p.metadata.name).truncate(p.metadata.is_private?45:48).end(),p.is_private_string=p.metadata.is_private?"true":"false",p.created_by_user=null!=p.created_on,p.created_by_user?(e=new Date(p.created_on),y="created_on"):(e=new Date(p.starred_on),y="starred_on"),i=r.format(e,{format:"date",type:"long"}),p.timestamp_display=Strava.I18n.Locale.t("templates.routes.route_index_view."+y,{date:i}),p.length_display=n.format(p.metadata.length),p.elevation_gain_display=a.format(p.metadata.elevation_gain),null!=v&&v>0&&(p.moving_time=Strava.Routes.Route.movingTime(p.metadata.length,v));o="?",c=this.pageContext.filters();for(s in c)m=c[s],o+=s+"="+m+"&";return t={routes:f,mapIdBase:this.pageContext.mapIdBase(),pagination:this.pageContext.pagination(),filteredURI:o,routeType:d,hasRoutes:this.pageContext.hasRoutes(),movingTimeExplanation:h},this.renderTemplate(t),this},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.RouteUpsellView=function(e){function i(){this.create_template("#route-upsell-content"),this.lightbox=new Strava.Ui.LightboxView,this.lightbox.bind("lightboxClosed",function(t){return function(){return t.undelegateEvents()}}(this)),i.__super__.constructor.call(this)}return t(i,e),i.prototype.className="routes-upsell-lightbox",i.prototype.events={"click #next-page":"nextSlide","click #prev-page":"prevSlide","click .pages li":"pageSlide"},i.prototype.render=function(t){return t=t||{},this.renderTemplate(t),this.lightbox.render(this.el),this.delegateEvents(),this},i.prototype.nextSlide=function(){var t,e,i;return i=this.$(".slides > div"),e=this.$(".slides .selected"),t=i.index(e),t++,t>i.length-1&&(t=i.index(i.first())),this.gotoSlide(t)},i.prototype.prevSlide=function(){var t,e,i;return i=this.$(".slides > div"),e=this.$(".slides .selected"),t=i.index(e),t--,0>t&&(t=i.index(i.last())),this.gotoSlide(t)},i.prototype.pageSlide=function(t){var e;return e=this.$(".pages li").index(this.$(t.currentTarget)),this.gotoSlide(e)},i.prototype.gotoSlide=function(t){var e,i,r,n;
return this.$(".selected").removeClass("selected"),i=this.$(".slides > div")[t],this.$(i).addClass("selected"),e=this.$(".pages li")[t],this.$(e).addClass("selected"),r=this.$(".slides .selected"),n=-1*r.position().left,this.$(".slides").css("left",n)},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Util"),Strava.Util.MenuRouter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e,i){return this.id=i,this.baseUrl=t,this.route(this.baseUrl+"/:id",e),this.route(this.baseUrl+"/:id/",e)},i.prototype.addMenuItem=function(t,e){var i;return t?(i=t.replace(/^\s+|\s+$/g,""),0===i.length?this:(this.route(this.baseUrl+"/:id/"+t,e),this.route(this.baseUrl+"/:id/"+t+"/",e),this)):this},i.prototype.addRoute=function(t,e){return this.route(this.baseUrl+"/:id"+t,e),this},i.prototype.changeMenuTo=function(t,e){return null==e&&(e=!0),this.navigate("/"+this.baseUrl+"/"+this.id+"/"+t,{trigger:e,replace:!0})},i.prototype.start=function(){return Backbone.history.start(Modernizr.history?{pushState:!0,silent:!1}:{pushState:!1,silent:!1,hashChange:!1})},i}(Backbone.Router)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.MenuRouter=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t,e,r,n){return i.__super__.initialize.call(this,t,e,r),this.context=n},i.prototype.changeMenuTo=function(t,e){return null==e&&(e=!0),this.context.fullscreen()?this.trigger("route:"+t):this.navigate("/"+this.baseUrl+"/"+this.id+"/"+t,{trigger:e,replace:!0})},i}(Strava.Util.MenuRouter)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.MenuView=function(e){function i(t){this.router=t,i.__super__.constructor.call(this)}return t(i,e),i.prototype.el="#pagenav",i.prototype.events={"click li a":"handleMenuClick"},i.prototype.initialize=function(){return this.$("li a").each(function(t){return function(e,i){var r;return r=t.$(i).data("menu"),t.router.bind("route:"+r,function(){return t.handleRouteChange(r)})}}(this))},i.prototype.handleMenuClick=function(t){var e;return e=this.$$(t.currentTarget),this.router.changeMenuTo(e.data("menu"))},i.prototype.handleRouteChange=function(t){return this.$("li").removeClass("selected"),this.$("a[data-menu='"+t+"'],a[data-menu-alt='"+t+"']").parent("li").addClass("selected")},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.FilterView=function(e){function i(t){var e;i.__super__.constructor.call(this),e=t.filters(),null!=e&&null!=e.type&&this.changeRouteType({target:this.$el.find("#route-type .button[data-value="+e.type+"]")})}return t(i,e),i.prototype.el="form.sport-select",i.prototype.events={"click #route-type .button":"changeRouteType"},i.prototype.changeRouteType=function(t){var e,i,r,n,a;return r=this.$(t.target),i=r.closest(".switches"),i.find(".button").removeClass("active"),r.addClass("active"),e=i.find("input"),a=e.val(),n=r.data("value"),e.val(n),""!==a&&a!==n?this.$el.submit():void 0},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.StarredRoute=function(e){function i(t){i.__super__.constructor.call(this,_.extend(t,{id:t.route_id}))}return t(i,e),i.prototype.url=function(){return"/routes/"+this.get("route_id")+"/starred"},i.prototype.toggleStar=function(){var t;return t="on"===this.get("active")?"off":"on",this.set("active",t),this.save()},i}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["routes/starred"]=function(t){return function(){var t;return t=[],t.push("&#9733;"),t.join("\n")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.StarredRouteView=function(e){function i(t,e){null==e&&(e={}),i.__super__.constructor.call(this,e),this.starredRoute=t,this.starredRoute.bind("change",this.render,this),this.template="routes/starred","on"===this.starredRoute.get("active")?this.$el.attr("title",Strava.I18n.Locale.t("strava.routes.starred_route_view.unstar")):this.$el.attr("title",Strava.I18n.Locale.t("strava.routes.starred_route_view.star"))}return t(i,e),i.prototype.className="starred",i.prototype.events={click:"handleStarClick"},i.buildViews=function(t){return jQuery(t).each(function(t,e){var i,r;return i=jQuery(e),r=new Strava.Routes.StarredRoute({route_id:i.data("route-id"),active:i.hasClass("active")?"on":"off"}),new Strava.Routes.StarredRouteView(r,{el:e})})},i.prototype.render=function(){return this.renderTemplate(this.starredRoute.toJSON()),"on"===this.starredRoute.get("active")?(this.$el.addClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.routes.starred_route_view.unstar"))):(this.$el.removeClass("active"),this.$el.attr("title",Strava.I18n.Locale.t("strava.routes.starred_route_view.star"))),this},i.prototype.handleStarClick=function(){return this.starredRoute.toggleStar(),!1},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.Routes.SubactionRouteView=function(e){function i(t,e){null==e&&(e={}),this.route=t,this.route.urlRoot="/routes",i.__super__.constructor.call(this,e)}return t(i,e),i.prototype.events={"click .delete-route":"handleDeleteClick"},i.buildViews=function(t){return jQuery(t).each(function(t,e){var i,r,n;return i=jQuery(e),n=i.data("route-id"),r=new Backbone.Model({id:n}),new Strava.Routes.SubactionRouteView(r,{el:e})})},i.prototype.handleDeleteClick=function(){return confirm(Strava.I18n.Locale.t("templates.routes.subaction_route_view.confirm_delete"))&&this.route.destroy({success:function(t){return function(e,i){return null!=i.error?alert(i.error):t.$el.closest(".route-card").fadeOut("fast")}}(this)}),!0},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Routes"),Strava.Routes.ShareLightboxMainView=function(e){function i(t){i.__super__.constructor.call(this),this.data=t,this.createTemplate("#route-share-lightbox-main")}return t(i,e),i.prototype.events={"focus .copy-link input":"selectInput","click .copy-link input":"returnFalse"},i.prototype.render=function(){var t;return t=this.dataAsJSON(),this.renderTemplate(t),this.$(".copy-link input").focus(function(){return this.select()}).mouseup(function(){return!1}),this},i.prototype.selectInput=function(t){return this.$(t).select()},i.prototype.returnFalse=function(){return!1},i.prototype.dataAsJSON=function(){var t;return t=this.data.toJSON()},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.Resizer=function(e){function i(t,e){i.__super__.constructor.call(this),this.initializeAttributes(r),this.el=t,this.container=e,this.el.bind("mousedown",function(t){return function(e){return t.handleMouseDown(e),!1}}(this)),this.id=""+Math.floor(1e3*Math.random())}var r;return t(i,e),r={min:250,size:300,onMove:null,onComplete:null},i.prototype.handleMouseDown=function(t){var e,i,r;return e=this.el.parent().find(this.container),r=e.outerHeight(),i=t.clientY||t.PageY,this.$document().bind("mousemove."+this.id,function(t){return function(n){var a,s;return null!=t.onMove()&&t.onMove()(),s=n.clientY||n.pageY,a=r+s-i,a=Math.max(t.min(),a),e.css("height",a),!1}}(this)).bind("mouseup."+this.id,function(t){return function(){return t.$document().unbind("."+t.id),null!=t.onComplete()&&t.onComplete()(),!1}}(this))},i.prototype.resetToDefault=function(){return this.el.parent().find(this.container).css("height",this.size())},i}(Strava.Base)}.call(this);